
##### ä¸€ç»´

```c++
#include <bits/stdc++.h>
using namespace std;
using ll = long long;
// å‰ç¼€å’Œ å’Œ å·®åˆ† æ˜¯ä¸€ä¸ªäº’é€†çš„è¿‡ç¨‹
// å‰ç¼€çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯æ±‚å’Œ
// å·®åˆ†çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯ä¿®æ”¹
const int N = 2e5 + 9;
ll a[N]; // æºæ•°ç»„
ll prefix[N]; // å‰ç¼€å’Œæ•°ç»„
ll diff[N]; // å·®åˆ†æ•°ç»„

int main()
{
	ios::sync_with_stdio(0),cin.tie(0),cout.tie(0);
	// input
	int n;cin >> n;
	for(int i = 1;i <= n;i ++) cin >> a[i];
	// å‰ç¼€å’Œ
	for(int i = 1;i <= n;i ++) prefix[i] = prefix[i - 1] + a[i];
	// å·®åˆ†
	for(int i = 1;i <= n;i ++) diff[i] = a[i] - a[i - 1];
	return 0;
}
```

##### äºŒç»´

```c++
#include <bits/stdc++.h>
using namespace std;
using ll = long long;

const int N = 1e3 + 9;
ll a[N][N];
ll prefix[N][N];

int main(void)
{
	ios::sync_with_stdio(0),cin.tie(0),cout.tie(0);
	// input
	int n,m,q;cin >> n >> m >> q;
	for(int i = 1;i <= n;i ++)
	Â  Â  for(int j = 1;j <= m;j ++)
	Â  Â  Â  Â  cin >> a[i][j];
	// å‰ç¼€å’Œ
	for(int i = 1;i <= n;i ++)
	Â  Â  for(int j = 1;j <= m;j ++)
	Â  Â  Â  Â  pre_a[i][j] += pre_a[i - 1][j] + pre_a[i][j - 1] - pre_a[i - 1][j - 1] + a[i][j];
	Â  Â  Â  Â  
	return 0;
}Â  Â  Â  Â  Â  Â  
```

```c++
#include <bits/stdc++.h> 
using namespace std; 
using ll = long long; 

const int N = 1e3 + 9; 
int a[N][N],diff[N][N]; 

void solve() 
{ 
	int n,m,q;
	cin >> n >> m >> q; 
	for(int i = 1;i <= n;i ++) 
		for(int j = 1;j <= m;j ++) 
			cin >> a[i][j]; 
	for(int i = 1;i <= n;i ++)
		for(int j = 1;j <= m;j ++) 
		{ 
			diff[i][j] += a[i][j]; 
			diff[i + 1][j] -= a[i][j]; 
			diff[i][j + 1] -= a[i][j]; 
			diff[i + 1][j + 1] += a[i][j]; 
		} 
	while(q --) 
	{ 
		int x1,y1,x2,y2,c;
		cin >> x1 >> y1 >> x2 >> y2 >> c; 
		diff[x1][y1] += c; 
		diff[x2 + 1][y2 + 1] += c; 
		diff[x1][y2 + 1] -= c; 
		diff[x2 + 1][y1] -= c; 
	} 
	for(int i = 1;i <= n;i ++) 
		for(int j = 1;j <= m;j ++) 
			a[i][j] = a[i - 1][j] + a[i][j - 1] - a[i - 1][j - 1] + diff[i][j]; 
			
	for(int i = 1;i <= n;i ++) 
		for(int j = 1;j <= m;j ++) 
			cout << a[i][j] << " \n"[j == m]; 
} 

int main(void) 
{ 
	ios::sync_with_stdio(0),cin.tie(0),cout.tie(0); 
	int _ = 1; 
	while(_ --) solve(); 
	return 0; 
}
```

```c++
#include <bits/stdc++.h>
using namespace std;
using ll = long long;

const int N = 2e5 + 9;

ll pre[N]; // ä¸Šä¸€èŠ‚ç‚¹
ll c[N]; // æ¡¶ ç”¨æ¥è®¡æ•°(å¤§å°)
vector<int> v; // å­˜å‚¨å„ä¸ªè¿é€šå—çš„å¤§å°ï¼Œä¸”æ–¹ä¾¿æ’åºï¼Œä»¥ä»å°åˆ°å¤§è¾“å‡º

int find(int x) // æŸ¥
{
	return pre[x] = (pre[x] == x ? x : find(pre[x]));
}
void merge(int a,int b) // å¹¶
{
	pre[find(a)] = find(b);
}

int main(void)
{
	ios::sync_with_stdio(0),cin.tie(0),cout.tie(0);
	int n,m;cin >> n >> m;
	for(int i = 1;i <= n;i ++) pre[i] = i; // é¢„å¤„ç†
	for(int i = 1;i <= m;i ++) 
	{
		int x,y;cin >> x >> y;
		merge(x,y);
	}
	return 0;
}
```




```c++
ll qmi(ll a,ll b)
{
    ll res = 1;
    while(b)
    {
        // a -> åº•
    	// b -> å¹‚
        if(b&1) res = res * a % p;
        a = a * a % p;
        b >>= 1;
        // å¿…ç„¶ä¼šæœ‰bå˜ä¸º1çš„æ—¶åˆ»ï¼Œæ­¤æ—¶aå³ä¸ºæ‰€æ±‚
        // bæœ‰ä¸¤ç§æƒ…å†µï¼šå¶æ•°æ—¶ï¼Œåº•æ•°å¹³æ–¹ï¼Œbæ•´é™¤2ï¼›
        // 				  å¥‡æ•°æ—¶ï¼Œåº•æ•°å¹³æ–¹ï¼Œå¹‚æ•´é™¤2å‘ä¸‹å–æ•´ï¼Œè¿˜æœ‰1é¡¹åœ¨æ­¤è¿‡ç¨‹ä¸­è¢«ææ²¡äº†ï¼Œæ‰€ä»¥åœ¨æ­¤ä¹‹å‰è¿˜è¦åœ¨åŸåŸºç¡€ä¸Šä¹˜ä»¥åº•æ•°
    }
    return res;
}
```

### ä¹˜æ³•é€†å…ƒ

#### ç†è§£ï¼š

å‰æï¼ša / b â‰¡ x (mod p) ï¼› a * inv(b) â‰¡ x (mod p)

ï¼ˆ1ï¼‰ï¼ša â‰¡ bx (mod p)

ï¼ˆ2ï¼‰ï¼ša * inv(b) * b â‰¡ bx (mod p)

ï¼ˆ2ï¼‰-ï¼ˆ3ï¼‰ï¼ša * (inv(b) * b - 1) â‰¡ 0 (mod p)

æ•…æˆ‘ä»¬æ‰¾bçš„ä¹˜æ³•é€†å…ƒï¼Œå³ï¼ˆinv(b) * b - 1ï¼‰â‰¡ 0 (mod p)ï¼Œä¹Ÿå°±æ˜¯**inv(b) * b â‰¡ 1 (mod p)**ã€‚

#### ç®€å•å®šä¹‰ï¼š

åœ¨ æ¨¡p æœ‰æ„ä¹‰çš„æ¡ä»¶ä¸‹ï¼Œ è‹¥ ax â‰¡ 1 ( mod p ï¼‰, åˆ™ç§° a å…³äº 1 æ¨¡ pçš„ä¹˜æ³•é€†å…ƒä¸º xã€‚

#### å­˜åœ¨æ€§ï¼š

å¦‚ å– b=2,p=10 åˆ™ 2 * b![_{inv}](https://latex.csdn.net/eq?_%7Binv%7D)![\equiv](https://latex.csdn.net/eq?%5Cequiv)1 ï¼ˆ mod 10 ) ï¼Œå³ä¹˜æ³•é€†å…ƒå¹¶ä¸æ€»å­˜åœ¨ã€‚

ä½•æ—¶å­˜åœ¨ï¼Ÿ

ç»“è®ºï¼š**ä¹˜æ³•é€†å…ƒå­˜åœ¨å½“ä¸”ä»…å½“ bä¸päº’è´¨**

å¼•å…¥ï¼š

**è£´èœ€å®šç†**ï¼š
è£´èœ€å®šç†ï¼ˆBÃ©zout's Identityï¼‰æŒ‡å‡ºï¼Œå¯¹äºä»»æ„ä¸¤ä¸ªæ•´æ•° *a* å’Œ *b*ï¼Œå¦‚æœ gcd(*a*,*b*)=*d*ï¼Œé‚£ä¹ˆå­˜åœ¨æ•´æ•° *x* å’Œ *y*ï¼Œä½¿å¾— *ax+by=d*ã€‚

è¯æ˜ï¼š

1. **åº”ç”¨è£´èœ€å®šç†**ï¼š
   æˆ‘ä»¬éœ€è¦è¯æ˜ *b* ä¸ *p* äº’è´¨æ—¶ï¼Œå­˜åœ¨ *x* ä½¿å¾— b*â‹…*x*â‰¡1(mod* p)ã€‚
   - å¦‚æœ gcd(*b*,*p*)=1ï¼Œæ ¹æ®è£´èœ€å®šç†ï¼Œå­˜åœ¨æ•´æ•° *x* å’Œ *y*ï¼Œä½¿å¾— *bx+py=1*ã€‚
   - è¿™æ„å‘³ç€ b*x*â‰¡1(mod *p*)ï¼Œå³ *x* æ˜¯ *b* çš„ä¹˜æ³•é€†å…ƒã€‚
2. **åå‘è¯æ˜**ï¼š
   æˆ‘ä»¬éœ€è¦è¯æ˜å¦‚æœ *b* ä¸ *p* ä¸äº’è´¨ï¼Œåˆ™ *b* æ²¡æœ‰ä¹˜æ³•é€†å…ƒã€‚
   - å¦‚æœ gcd(*b*,*p*)=*d*>1ï¼Œé‚£ä¹ˆ *b* å’Œ *p* æœ‰ä¸€ä¸ªå…¬å› æ•° *d*ã€‚
   - å‡è®¾å­˜åœ¨ *x* ä½¿å¾— b*â‹…*xâ‰¡1(mod *p*)ï¼Œé‚£ä¹ˆ b*â‹…*x*=*k**p*+1 å¯¹äºæŸä¸ªæ•´æ•° *k*ã€‚
   - ç”±äº *d* æ˜¯ *b* å’Œ *p* çš„å…¬å› æ•°ï¼Œ*d* ä¹Ÿå¿…é¡»æ˜¯ 1 çš„å› æ•°ï¼Œè¿™ä¸ *d*>1 çŸ›ç›¾ã€‚
   - å› æ­¤ï¼Œb* æ²¡æœ‰ä¹˜æ³•é€†å…ƒã€‚

#### æ±‚æ³•ï¼š

###### 1. è´¹é©¬å°å®šç†æ±‚é€†å…ƒ

1. **ä»€ä¹ˆæ˜¯è´¹é©¬å°å®šç†ï¼Ÿ**

   > å®šä¹‰ï¼šå¦‚æœ *p* æ˜¯ä¸€ä¸ªè´¨æ•°ï¼Œä¸” *a* æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œä¸” *a* ä¸æ˜¯ *p* çš„å€æ•°ï¼Œé‚£ä¹ˆ *a* ^ *{ pâˆ’1 }* â‰¡ 1 ( mod *p* )ã€‚
   >
   > æ¨è®ºï¼šå¯¹äºä»»ä½•æ•´æ•° *a* å’Œè´¨æ•° *p*ï¼Œ*a* ^ *p* â‰¡ *a* ( mod *p* )ã€‚

2. **è´¹é©¬å°å®šç†è¯æ˜ï¼š**

   > â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
   >
   > æˆ‘ä»¬é¦–å…ˆè€ƒè™‘æ•´æ•°aï¼Œ2aï¼Œ3aï¼Œâ€¦ï¼ˆ p - 1 )aã€‚è¿™äº›æ•°éƒ½ä¸ç­‰äºpå¯¹å…¶ä»–æ•°çš„æ¨¡ï¼Œä¹Ÿä¸ç­‰äº0ã€‚
   >
   > å¦‚æœè¿™æ ·ï¼Œé‚£ä¹ˆæœ‰ï¼šr Ã— a â‰¡ s Ã— a ï¼ˆ mod p ï¼‰ï¼Œ1 â‰¤ r < s â‰¤ p - 1ï¼Œ
   >
   > é‚£ä¹ˆï¼Œä¸¤è¾¹æ¶ˆå»aå°†å¾—åˆ° r â‰¡ s ( mod p )ï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸º r å’Œ s éƒ½åœ¨ 1 å’Œ p - 1 ä¹‹é—´ã€‚
   >
   > å› æ­¤ï¼Œå‰ä¸€ç»„æ•´æ•°å¿…é¡»åŒä½™æ¨¡ p åˆ°1ï¼Œ2ï¼Œâ€¦p - 1ã€‚
   >
   > æŠŠè¿™äº›åŒä½™ç›¸ä¹˜ï¼Œä½ ä¼šå‘ç°ï¼ša Ã— 2a Ã— 3a Ã— â€¦ Ã— (p - 1) Ã— a â‰¡ 1 Ã— 2 Ã— 3 Ã— â€¦ Ã— (p - 1) ( mod p)æ„å‘³ç€a Ã— ï¼ˆp - 1ï¼‰! â‰¡ ï¼ˆp - 1ï¼‰!ï¼ˆmod pï¼‰ã€‚
   >
   > ä»è¿™ä¸ªè¡¨è¾¾å¼çš„ä¸¤è¾¹æ¶ˆå»ï¼ˆp - 1ï¼‰!ï¼Œæˆ‘ä»¬ä¾¿å¾—åˆ°ï¼ša^{p-1}  â‰¡ 1 ( mod p )ã€‚
   > â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

3. **invä»£ç å®ç°ï¼š**

   ç”±è´¹é©¬å°å®šç†ï¼šè‹¥ p ä¸ºè´¨æ•°ï¼Œ åˆ™ a![^{p-1}](https://latex.csdn.net/eq?%5E%7Bp-1%7D)![\equiv](https://latex.csdn.net/eq?%5Cequiv)1 ( mod p) ï¼Œå¾—ï¼ša x a![^{p-2}](https://latex.csdn.net/eq?%5E%7Bp-2%7D) ![\equiv](https://latex.csdn.net/eq?%5Cequiv) 1 ( mod p)ï¼›å³ï¼ša![^{p-2}](https://latex.csdn.net/eq?%5E%7Bp-2%7D)æ˜¯aåœ¨æ¨¡pæ„ä¹‰ä¸‹çš„ä¹˜æ³•é€†å…ƒã€‚

   ```c++
   // æ±‚aåœ¨æ¨¡pæ„ä¹‰ä¸‹çš„é€†å…ƒ
   ll inv(ll a) { return qmi(a,p-2); }		// è´¹é©¬å°å®šç†æ±‚ä¹˜æ³•é€†å…ƒï¼ˆpä¸ºè´¨æ•°æ—¶ï¼‰	qmiä¸ºå¿«é€Ÿå¹‚
   ```

   **å±€é™æ€§**ï¼šå¿…é¡»æ»¡è¶³ *<u>pä¸ºè´¨æ•°</u>* çš„å‰ææ¡ä»¶ ï¼Œæ‰å¯æ±‚é€†å…ƒ

###### 2. æ‰©å±•æ¬§å‡ é‡Œå¾—æ±‚é€†å…ƒ

  1. **ä»€ä¹ˆæ˜¯æ¬§å‡ é‡Œå¾—ç®—æ³•ï¼Ÿ**

     > æ¬§å‡ é‡Œå¾—ç®—æ³•ï¼Œåˆç§°**è¾—è½¬ç›¸é™¤æ³•**ï¼Œæ˜¯æŒ‡ç”¨äºè®¡ç®—ä¸¤ä¸ªéè´Ÿæ•´æ•°aï¼Œbçš„æœ€å¤§å…¬çº¦æ•°ã€‚
     >
     > å…¬å¼ ï¼šgcd ( aï¼Œb ) = gcd ( bï¼Œa mod b )

  2. **è¯æ˜æ¬§å‡ é‡Œå¾—ç®—æ³•**ï¼š

     å³è¯æ˜ï¼š`gcd ( aï¼Œb ) = gcd ( bï¼Œa mod b )`

     > å‰æï¼ša = md , b = nd , m å’Œ n äº’è´¨	=>	d æ˜¯ a å’Œ b çš„æœ€å¤§å…¬çº¦æ•°
     >
     > è¯æ˜ï¼š
     >
     > è®¾gcd ( a , b ) = d1ï¼Œå³ï¼ša = m * d1 , b = n * d1ï¼Œm , näº’è´¨ï¼›
     >
     > ä»¤ a = qb + rï¼Œåˆ™ r = a - qb = m * d1 - qn * d1 = (m - qn) * d1;
     >
     > è¦è¯æ˜æ¬§å‡ é‡Œå¾—ç®—æ³•ï¼Œåªéœ€è¯æ˜ b å’Œ r çš„æœ€å¤§å…¬å› æ•°ç­‰äº d1 å³å¯
     > ç”±ä¸Šè¿°è¿‡ç¨‹å¯å¾—ï¼Œrå¯ä»¥è¢«d1æ•´é™¤ï¼Œå³ **d1 æ˜¯ r å’Œ b çš„å…¬çº¦æ•°**ã€‚
     > å› æ­¤ï¼Œ**åªéœ€è¯æ˜ n å’Œ m-qn äº’è´¨å³å¯**ã€‚
     >
     > ä¸‹é¢ç”¨åè¯æ³•æ¥è¯æ˜ï¼š
     >
     > å‡è®¾ n ä¸ m - qn ä¸äº’è´¨ï¼Œè®¾ gcd ( n , m - qn ) = d2 (d2 > 1)ï¼Œåˆ™ï¼šn = xd2 ï¼Œm - qn = yd2 ï¼Œå³ m = (qx + y)d2 => m , n ä¸äº’è´¨ï¼Œè¿™ä¸å‰æ m , n äº’è´¨ç›¸çŸ›ç›¾ï¼Œå› æ­¤å‡è®¾ä¸æˆç«‹ï¼Œ n å’Œ m - qn äº’è´¨ã€‚
     >
     > æ‰€æœ‰ r å’Œ b çš„æœ€å¤§å…¬çº¦æ•°ä¸º d1ã€‚
     >
     > gcd ( aï¼Œb ) = gcd ( bï¼Œa mod b )ï¼Œå‘½é¢˜å¾—è¯

  3. **æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•ï¼š**

     > å®šä¹‰ï¼šä¸€ç§å»ºç«‹åœ¨**æ¬§å‡ é‡Œå¾—ç®—æ³•**ä¹‹ä¸Šçš„ç®—æ³•ï¼Œä¸ä»…è®¡ç®—ä¸¤ä¸ªæ­£æ•´æ•° *a* å’Œ *b* çš„æœ€å¤§å…¬çº¦æ•°ï¼ˆGCDï¼‰ï¼Œè¿˜åŒæ—¶æ‰¾åˆ°æ»¡è¶³**è´ç¥–ç­‰å¼**ï¼ˆBÃ©zout's identityï¼‰çš„æ•´æ•°ç³»æ•° *x* å’Œ *y*ï¼Œä½¿å¾—ï¼š*ax*+*by* = gcd(*a*,*b*)

  4. **æ¨å¯¼æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•ï¼š**

     è¯æ˜ï¼šå­˜åœ¨æ•´æ•°å¯¹( xï¼Œy )ä½¿å¾— `ax + by = gcd( aï¼Œb )`

     >  è¯æ˜ï¼š
     >  ä¸å¦¨è®¾ a > bï¼Œ
     >      å½“ b = 0 æ—¶ï¼Œ
     >
     >  â€‹				  `aâˆ—1+bâˆ—0 = gcd( aï¼Œb ) = a`ï¼Œæ­¤æ—¶ x=1ï¼Œy=0 
     >  â€‹       å½“ b !=0 æ—¶ï¼Œ
     >
     >  â€‹				 è®¾ `aâˆ—x1 + bâˆ—y1 = gcd( aï¼Œb )` ï¼Œ`bâˆ—x2 + a%bâˆ—y2 = gcd( bï¼Œa%b ) `
     >
     >  â€‹				 åˆç”±äº`gcd(a,b) = gcd( bï¼Œa%b )`
     >
     >  â€‹				 æ‰€ä»¥æœ‰  `aâˆ—x1 + bâˆ—y1 = bâˆ—x2 + a%bâˆ—y2`
     >  â€‹				 åˆå› ä¸º  `a%b = a âˆ’ ( a / b )âˆ—b` ï¼Œ 
     >  â€‹	   		  å¾—åˆ°   `aâˆ—x1 + bâˆ—y1 = aâˆ—y2 + bâˆ—x2 âˆ’ ( a / b )âˆ—bâˆ—y2` 
     >
     >  â€‹				 å³        `x1 = y2`
     >  â€‹     						`y1 = x2 âˆ’ (a/b)âˆ—y2`  
     >
     >  â€‹				 // å› æ­¤å¯ä»¥é€’å½’çš„å®šä¹‰exgcdï¼ŒåŒæ · b=0 æ—¶é€’å½’ç»“æŸï¼›åŒæ—¶è¿”å›æœ€å¤§å…¬çº¦æ•° ã€‚
     >
     >  ç»¼ä¸Šï¼šå­˜åœ¨æ•´æ•°å¯¹( xï¼Œy )ä½¿å¾— `ax + by = gcd( aï¼Œb )`

  5. **exgcdä»£ç å®ç°**ï¼š

     ```c++
     int exgcd( int a , int b , int &x , int &y )
     {
         // å½“ b = 0 æ—¶
         if(!b) 
         {
             x = 1,y = 0;
             return a;      
         }
         // å½“ b != 0 æ—¶
         int d = exgcd( b, a%b, x, y );
         int t = x;
         x = y;
         y = t - (a / b) * y;
         
         return d;
     }
     ```

  6. **åˆ©ç”¨æ‰©å±•æ¬§å‡ é‡Œå¾—æ±‚é€†å…ƒï¼š**

     æŠŠ `ax â‰¡ 1ï¼ˆ mod pï¼‰`ç§°ä¸º a å…³äº 1 mod p çš„ä¹˜æ³•é€†å…ƒã€‚ å®ƒçš„è§£å…¶å®å°±ç›¸å½“äºå¯»æ‰¾æ–¹ç¨‹ `ax+py=1` çš„è§£ã€‚æ ¹æ®ä¹˜æ³•é€†å…ƒçš„æ€§è´¨ï¼Œåªæœ‰å½“ a ä¸ p äº’è´¨ï¼Œa å…³äºæ¨¡ p çš„ä¹˜æ³•é€†å…ƒæ‰æœ‰è§£ã€‚å¦‚æœä¸äº’è´¨ï¼Œåˆ™æ— è§£ã€‚é‚£ä¹ˆè¿™ä¸ªæ–¹ç¨‹å°±æ˜¯ a,m äº’è´¨çš„å……è¦æ¡ä»¶æ˜¯æ–¹ç¨‹ `ax+py = 1` å¿…æœ‰æ•´æ•°è§£ã€‚

     > æ³¨æ„ï¼š
     >
     > æˆ‘ä»¬çŸ¥é“äº†çº¿æ€§æ–¹ç¨‹ ax + by = m æœ‰æ•´æ•°è§£çš„æ¡ä»¶ï¼Œå¹¶ä¸”æ ¹æ®ä¸Šè¿°ç®—æ³•ï¼Œä¹Ÿèƒ½æ±‚å‡ºä¸€ç»„æ–¹ç¨‹çš„è§£ã€‚ä½†æ˜¯ï¼Œè¿™ç»„è§£å¾ˆ**å¯èƒ½åŒ…å«è´Ÿæ•°**ï¼Œå½“æˆ‘ä»¬æ±‚é€†å…ƒæ—¶éœ€å°†å…¶è½¬åŒ–ä¸ºæ­£æ•°ã€‚

     ```c++
     // æ±‚aåœ¨æ¨¡pæ„ä¹‰ä¸‹çš„é€†å…ƒ
     ll inv(ll a)
     {
         ll x = 1,y = 0;
         ll d = exgcd(a,p,x,y);
         
         if(d == 1) { return ( x % p + p) % p;}	// ä¿è¯é€†å…ƒä¸ºæ­£æ•°
         else { return -1; }						// ax+py=1 ä¸æˆç«‹ï¼Œå³ a ï¼Œp  ä¸äº’è´¨ï¼Œæ— è§£
     }
     ```

###### 3.  çº¿æ€§é€’æ¨æ±‚é€†å…ƒ

 1. **çº¿æ€§é€’æ¨å¿…è¦æ€§**

    > exgcdå’Œè´¹é©¬å°å®šç†**åªé€‚åˆ**ç”¨æ¥æ±‚**å•ä¸ªé€†å…ƒ**ï¼Œæ±‚3e6ä»¥å†…æ‰€æœ‰çš„æ¨¡pæ„ä¹‰ä¸‹çš„é€†å…ƒè‚¯å®šä¼šè¶…æ—¶ï¼›æ­¤æ—¶ç”¨çº¿æ€§é€’æ¨æ±‚é€†å…ƒå¯ä»¥ä¿è¯æ—¶é—´å¤æ‚åº¦åœ¨O( n )å†…ã€‚

 2. **æ¨å¯¼çº¿æ€§é€’æ¨**

    > è®¾` t = p / i`ï¼Œ`k = p % i`ï¼Œæœ‰ï¼š`p = i * t + k`
    > å³ `i * t + k Î 0 ( mod p )`
    > å³ `k Î - i * t ( mod p )`
    > ä¸¤è¾¹åŒæ—¶é™¤ä»¥ `i * k`
    > æœ‰ `1 / i Î - t / k ( mod p )`
    > å°†kï¼Œtå¸¦å…¥
    > æœ‰ `inv[ i ] Î - p / i * inv[ p % i ] ( mod p )`
    > ä¸ºé˜²æ­¢æœ‰è´Ÿæ•°ï¼Œæœ‰  `inv[ i ] = ( p - p / i) * inv[ p % i ]) % m`

    **æ ¸å¿ƒï¼š`inv[ i ] = ( p - p / i ) * inv[ p % i ] % p`**

 3. **çº¿æ€§é€’æ¨ä»£ç å®ç°ï¼š**

    ```c++
    long long inv[N];
    // æ±‚å–åŒºé—´[1,p)æ‰€æœ‰çš„å…³äºæ¨¡pæ„ä¹‰ä¸‹çš„é€†å…ƒ
    void inv( long long p )
    {
        inv[1] = 1;
        for(int i = 2;i <= p - 1;i ++)
            inv[i] = (p - p/i) * inv[p%i] % p;
    }
    ```

###### 4. æ¬§æ‹‰å®šç†æ±‚é€†å…ƒ

 1. **ä»€ä¹ˆæ˜¯æ¬§æ‹‰å®šç†ï¼Ÿ**

    è‹¥aã€mäº’è´¨ï¼Œåˆ™æœ‰
    $$
    a^{Ï†( m)}  â‰¡ 1\ ( mod\ m )
    $$
    Ï†( m)ç§°ä¸ºæ¬§æ‹‰å‡½æ•°ï¼Œè¡¨ç¤º1~mä¸­ä¸ mäº’è´¨çš„ä¸ªæ•°ã€‚

 2. **è¯æ˜æ¬§æ‹‰å®šç†ï¼š**

    ![image-20240802113205587](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20240802113205587.png)

3. **æ¨å¯¼æ¬§æ‹‰å‡½æ•°ï¼š**								<img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20240802113856459.png" alt="image-20240802113856459" style="zoom:80%;" />

â€‹		å–è‡ªï¼š[é€†å…ƒã€æ¬§æ‹‰å®šç†](https://www.cnblogs.com/hh--boke/p/15377467.html)

4. **æ¬§æ‹‰å®šç†ä»£ç å®ç°ï¼š**

   ```c++
   // æ±‚å•ä¸ªÏ•(n)
   ll get_phi(ll n)
   {
       ll phi = 1;
       for(int i = 2;i <= n/i;i ++)
       {
           if(n%i == 0)
           {
               phi *= (i - 1);
               n /= i;
               while(n%i == 0)
               {
                   n /= i;
                   phi *= i;
               }
           }
       }
       if(n > 1) phi *= (n - 1); //næœ‰ä¸€ä¸ªå¤§äºâˆšnçš„è´¨æ•°
       return phi;	
   }
   // æ±‚Ï•(1)â‹…â‹…â‹…â‹…Ï•(n)
   const int maxn = 2e5 + 9;
   int prime[maxn],tot,is[maxn],phi[maxn];
   void get_phi_s(ll n)
   {
       phi[1] = 1;
       for(int i = 2;i <= n;i ++)
       {
           if(!is[i]) prime[++ tot] = i,phi[i] = i - 1;
           for(int j = 1;j <= tot && prime[j]*i <= n;j ++)
           {
               is[i * prime[j]] = 1;
               if(i % prime[j] == 0) //è¯´æ˜å·²ç»æœ‰äº†ä¸€ä¸ªprime[i]
               {
                   phi[i * prime[j]] = phi[i] * prime[j];
                   break;
               }
               phi[i * prime[j]] = phi[i] * (prime[j] - 1);
           }
       }
       return ;
   }
   // å¿«é€Ÿå¹‚
   ll qmi(ll a,ll b)
   {
       ll res = 1;
       while(b)
       {
           if(b&1) res = res * a % p;
           a = a * a % p;
           b >>= 1;
       }
       return res;
   }
   // é€†å…ƒ
   ll inv(ll a) { return qmi(a,phi[a] - 1); }
   ```

##### åº”ç”¨ï¼š

> 1. **æ¨¡è¿ç®—ä¸­çš„é™¤æ³•**ï¼š
>    - åœ¨æ¨¡è¿ç®—ä¸­ï¼Œç›´æ¥è¿›è¡Œé™¤æ³•æ˜¯ä¸å…è®¸çš„ï¼Œå› ä¸ºæ¨¡è¿ç®—ä¸æ»¡è¶³é™¤æ³•çš„å°é—­æ€§ã€‚
>    - é€šè¿‡è®¡ç®— *b* çš„ä¹˜æ³•é€†å…ƒ inv(*b*)ï¼Œå¯ä»¥å°†é™¤æ³•è½¬æ¢ä¸ºä¹˜æ³•ï¼Œå³ a*/*b *â‰¡* a*â‹… inv(*b) (*mod* *m*)ã€‚
> 2. **ç»„åˆæ•°è®¡ç®—**ï¼š
>    - åœ¨è®¡ç®—ç»„åˆæ•° C*(*n*,*k*) = *n*! / (k*! Â· (*n*âˆ’*k*)!) æ—¶ï¼Œé€šå¸¸éœ€è¦è¿›è¡Œé™¤æ³•ã€‚ä¸ºäº†åœ¨æ¨¡ *m* ä¸‹è¿›è¡Œè®¡ç®—ï¼Œå¯ä»¥ä½¿ç”¨ä¹˜æ³•é€†å…ƒå°†é™¤æ³•è½¬æ¢ä¸ºä¹˜æ³•ã€‚
>    - ä¾‹å¦‚ï¼Œè®¡ç®— C*(*n*,*k) *mod* *m* æ—¶ï¼Œå¯ä»¥å…ˆè®¡ç®— *n*!ã€*k*! å’Œ (*n*âˆ’*k*)! çš„ä¹˜æ³•é€†å…ƒï¼Œç„¶åè¿›è¡Œä¹˜æ³•è¿ç®—ã€‚
> 3. **çº¿æ€§åŒä½™æ–¹ç¨‹**ï¼š
>    - è§£å†³çº¿æ€§åŒä½™æ–¹ç¨‹ a*x* â‰¡ *b*(mod *m*) æ—¶ï¼Œå¦‚æœ *a* å’Œ *m* äº’è´¨ï¼Œå¯ä»¥é€šè¿‡è®¡ç®— *a* çš„ä¹˜æ³•é€†å…ƒ *inv(a)* æ¥æ±‚è§£ *x*ï¼Œå³ x *â‰¡* b*â‹…* *inv(a) (mod m*)ã€‚
> 4. **ä¸­å›½å‰©ä½™å®šç†**ï¼š
>    - åœ¨ä¸­å›½å‰©ä½™å®šç†ï¼ˆCRTï¼‰çš„åº”ç”¨ä¸­ï¼Œä¹˜æ³•é€†å…ƒç”¨äºå°†å¤šä¸ªæ¨¡åŒä½™æ–¹ç¨‹ç»„åˆæˆä¸€ä¸ªå•ä¸€çš„è§£ã€‚
>    - ä¾‹å¦‚ï¼Œç»™å®šä¸€ç»„åŒä½™æ–¹ç¨‹ x *â‰¡* a*i* (mod *mi*)ï¼Œå…¶ä¸­ *mi* æ˜¯ä¸¤ä¸¤äº’è´¨çš„ï¼Œå¯ä»¥é€šè¿‡è®¡ç®—æ¯ä¸ª *mi* çš„ä¹˜æ³•é€†å…ƒæ¥ç»„åˆè¿™äº›æ–¹ç¨‹ã€‚
> 5. **RSAåŠ å¯†ç®—æ³•**ï¼š
>    - åœ¨RSAåŠ å¯†ç®—æ³•ä¸­ï¼Œä¹˜æ³•é€†å…ƒç”¨äºè®¡ç®—ç§é’¥ã€‚å…·ä½“æ¥è¯´ï¼Œéœ€è¦è®¡ç®— *e* çš„ä¹˜æ³•é€†å…ƒ *d*ï¼Œä½¿å¾— e*â‹…* d *â‰¡ 1 ( mod* Ï•*(*n*) )ï¼Œå…¶ä¸­ Ï•*(*n*) æ˜¯æ¬§æ‹‰å‡½æ•°ã€‚

### ç´ æ•°ç­›

#### åŸƒå¼ç­›æ³•	*O*(*nloglogn*)

```c++
#include <bits/stdc++.h>
using namespace std;
using ll = long long;

const int N = 1e8 + 9;
bitset<N> pri;	// 1è¡¨ç¤ºè¯¥å…ƒç´ ä¸æ˜¯ç´ æ•°
int primes[N];	// æŒ‰å‡ºç°é¡ºåºå­˜å‚¨ç´ æ•°
int pp = 0;		// index

inline void era(int x)
{
    for(int i = 2;i < x / i; ++ i)	// èŒƒå›´<x/iï¼Œå› ä¸ºå½“ i å¤§äº sqrt(x) æ—¶ï¼Œi * i ä¼šè¶…è¿‡ xï¼Œè¿™æ„å‘³ç€æ‰€æœ‰å°äº x çš„åˆæ•°å·²ç»è¢«æ ‡è®°è¿‡äº†ã€‚å› æ­¤ï¼Œæ²¡æœ‰å¿…è¦ç»§ç»­æ£€æŸ¥æ›´å¤§çš„ iã€‚
    {
        if(!pri[i])	// è‹¥æœªå‡ºç°å³æ˜¯ç´ æ•°
            for(ll j = i * i;j <= N;j += i) pri[j] = 1;	// å®ƒçš„å€æ•°éƒ½ä¸æ˜¯ç´ æ•°ï¼Œè¿›è¡Œæ ‡è®°ï¼›ä»i*iå¼€å§‹æ˜¯å› ä¸º<i*içš„æ•°å·²ç»è¢«ä¹‹å‰çš„ç´ æ•°ç­›è¿‡äº†
    }
    // æŒ‰é¡ºåºå­˜å‚¨ç´ æ•°
    for(int i = 2;i <= x;i ++) if(!pri[i]) primes[++ pp] = i;
}
```

#### æ¬§æ‹‰ç­›æ³•	*O*(*n*)

```c++
#include <bits/stdc++.h>
using namespace std;
using ll = long long;

const int N = 1e8 + 9;
bitset<N> pri;
int primes[N];
int pp = 0;

inline void ola(int x)
{
	for(int i = 2;i <= x;++ i)
	{
		if(!pri[i]) primes[++ pp] = i;
		for(int j = 1;primes[j] * i <= x;j ++)
		{
			pri[primes[j] * i] = 1;
			if(i % primes[j] == 0) break;
            // å¦‚æœ i èƒ½è¢« primes[j] æ•´é™¤ï¼Œåˆ™è·³å‡ºå†…å±‚å¾ªç¯ã€‚è¿™æ˜¯å› ä¸º i çš„æœ€å°è´¨å› æ•°å·²ç»æ‰¾åˆ°ï¼Œåç»­çš„æ ‡è®°å·¥ä½œå¯ä»¥ç”±æ›´å°çš„è´¨å› æ•°å®Œæˆã€‚
		}
	}
}
```

### ç¦»æ•£åŒ–å¤„ç†

é€‚ç”¨ï¼šæ“ä½œæ¬¡æ•°ä¸å¤šï¼Œç›¸å…³ç‚¹ä¸å¤š

```c++
#include <bits/stdc++.h>
using namespace std;
using ll = long long;

const ll inf = 8e18,p = 998244353;
const ll N =3e5 + 9;

vector<int> X;	// ç¦»æ•£åŒ–æ•°ç»„ã€‚å­˜å‚¨è¾“å…¥æ—¶å‡ºç°çš„ä¸‹æ ‡ï¼Œä¸ºåç»­å¤„ç†åšå‡†å¤‡ã€‚
ll a[N];		// ç¦»æ•£åŒ–å¤„ç†åï¼Œå°†æ•°æ®è½¬ç§»åˆ°æ•°ç»„ä¸Š

/*
2ä¸ªæ“ä½œ
addï¼ši x
queï¼šl r
*/
struct _
{
	int a,b;
}add[N],que[N];	
// è·å–ç¦»æ•£åŒ–åæ•°ç»„çš„ä¸‹æ ‡
int getidx(int x)
{
    // lower_bound æ‰¾å‡ºæ•°ç»„ä¸­ç¬¬ä¸€ä¸ª>=xçš„å…ƒç´ çš„è¿­ä»£å™¨
    // è¿”å›å€¼èŒƒå›´[1,X.size()]
	return lower_bound(X.begin(),X.end(),x) - X.begin() + 1;
}

void solve()
{
	int n,q;cin >> n >> q;
	for(int i = 1;i <= n;++ i)
	{
		int x,w;cin >> x >> w;
		X.push_back(x);
		add[i] = {x,w};
	}
	for(int i = 1;i <= q;++ i)
	{
		int l,r;cin >> l >> r;
		X.push_back(l),X.push_back(r);
		que[i] = {l,r};
	}
    // æ’åºå»é‡
	sort(X.begin(),X.end());
	X.erase(unique(X.begin(),X.end()),X.end());
    
	for(int i = 1;i <= n;++ i)
	{
		int x = getidx(add[i].a);
		a[x] += add[i].b;
	}
    // å‰ç¼€å’Œ
	for(int i = 1;i <= X.size();++ i) a[i] += a[i - 1];	
	for(int i = 1;i <= q;++ i)
	{
		int l = getidx(que[i].a);
		int r = getidx(que[i].b);
		cout << a[r] - a[l - 1] << '\n';
	}
	return;
}
int main(void)
{
	ios::sync_with_stdio(0),cin.tie(0),cout.tie(0);
	int _ = 1;
	while(_ --) solve();
	return 0;
}
```

### äºŒåˆ† & ä¸‰åˆ†

##### äºŒåˆ†

```c++
#include <bits/stdc++.h>
using namespace std;
using ll = long long;
  
const int N = 2e5 + 9;
int a[N];
  
bool check(ll mid)
{
	// TODO
	return false;
}

void solve()
{
	int n;cin >> n;
	for(int i = 1;i <= n;i ++) cin >> a[i];
	sort(a + 1,a + 1 + n);
	int l = 0,r = n + 1;
	while(l + 1 != r)
	{
		int mid = ((l + r) >> 1);
		if(check(mid)) l = mid;
		else r = mid;
	}
	int ans = l;
}

int main()
{
	ios::sync_with_stdio(0),cin.tie(0),cout.tie(0);
	int t;cin >> t;
	while(t --) solve();
	return 0;
}
```

##### ä¸‰åˆ†

```c++

```

## å•è°ƒæ•°æ®ç»“æ„ O(n)

### å•è°ƒæ ˆ

#### å®šä¹‰ï¼š

å•è°ƒæ ˆæ˜¯æŒ‡ä¸€ä¸ªæ ˆå†…éƒ¨çš„å…ƒç´ å…·æœ‰ä¸¥æ ¼å•è°ƒæ€§çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œåˆ†ä¸ºå•è°ƒé€’å¢æ ˆå’Œå•è°ƒé€’å‡æ ˆã€‚

#### æ€§è´¨ï¼š

* æ»¡è¶³æ ˆåº•åˆ°æ ˆé¡¶çš„å…ƒç´ å…·æœ‰ä¸¥æ ¼å•è°ƒæ€§ã€‚

* æ»¡è¶³æ ˆçš„å…ˆè¿›åå‡ºç‰¹æ€§ï¼Œè¶Šé è¿‘æ ˆé¡¶çš„å…ƒç´ è¶Šåå‡ºæ ˆã€‚

#### åŸç†ï¼š

â€‹	(1) å½“æ–°å…ƒç´ åœ¨å•è°ƒæ€§ä¸Šä¼˜äºæ ˆé¡¶æ—¶ï¼ˆå•å¢æ ˆæ–°å…ƒç´ æ¯”æ ˆé¡¶å¤§ï¼Œå•å‡æ ˆæ–°å…ƒç´ æ¯”æ ˆé¡¶å°ï¼‰ï¼Œå‹æ ˆï¼Œæ ˆæ·±+1ï¼›

â€‹	(2) å½“æ–°å…ƒç´ åœ¨å•è°ƒæ€§ä¸æ ˆé¡¶ç›¸åŒï¼ˆæ–°å…ƒç´ äºæ ˆé¡¶ç›¸åŒï¼‰æˆ–åŠ£äºæ ˆé¡¶æ—¶ï¼ˆå•å¢æ ˆæ–°å…ƒç´ æ¯”æ ˆé¡¶å°ï¼Œå•å‡æ ˆæ–°å…ƒç´ æ¯”æ ˆé¡¶å¤§ï¼‰ï¼Œå¼¹æ ˆï¼Œæ ˆæ·±-1ï¼›

#### å®ç°ï¼š

ã€æ¨¡æ¿ã€‘

```c++
#include <bits/stdc++.h>
using namespace std;
using ll = long long;
const int N = 2e5 + 9;
ll a[N],l[N],stk[N],top; // topé»˜è®¤ä¸ºé›¶
// ç”¨æ•°ç»„æ¨¡æ‹Ÿ å­˜æ”¾ä¸‹æ ‡(å¸¸ç”¨)
int main()
{
	ios::sync_with_stdio(0),cin.tie(0),cout.tie(0);
    // è¾“å…¥æ•°æ®
    int n;cin >> n;
    for(int i = 1;i <= n;i ++) cin >> a[i];
    
    for(int i = 1;i <= n;i ++)
    {
        // å½“æ ˆéç©ºå¹¶ä¸”å°†å…¥æ ˆçš„æ¯”æ ˆé¡¶æ›´ä¼˜ç§€(1.é å³ 2.æ›´å°) å°†æ ˆé¡¶å…ƒç´ popå‡ºå»
        while(top && a[stk[top]] >= a[i]) top --;
        // 1.è‹¥æ ˆç©ºäº† åˆ™è¯´æ˜å·¦è¾¹æ²¡æœ‰å…ƒç´ æ¯”ä»–å°ï¼Œå³ï¼šä¸å­˜åœ¨ å­˜å…¥-1
        // 2.è‹¥æ ˆæœªç©º åˆ™è¯´æ˜æ ˆé¡¶å…ƒç´ å³æœ€é è¿‘å®ƒä¸”å°çš„å…ƒç´ 
        if(!top) l[i] = -1;
        else l[i] = a[stk[top]];
        // pushå…ƒç´ 
        stk[++ top] = i;
    }
    // è¾“å‡º
    for(int i = 1;i <= n;i ++) cout << l[i] << ' ';        
    return 0;
}
```

#### åº”ç”¨ï¼š

1. æ±‚æœ€é•¿çš„å•è°ƒä¸Šå‡ / é€’å‡åŒºé—´

   [Loongintçš„èŠ±ç¯®](#)

2. é’ˆå¯¹æ¯ä¸ªæ•°ï¼Œå¯»æ‰¾å®ƒå’Œå®ƒå·¦ / å³è¾¹ç¬¬ä¸€ä¸ªæ¯”å®ƒå¤§ / å°çš„æ•°çš„å€¼ï¼Œä»¥åŠç›¸è·å¤šå°‘ä¸ªæ•°ã€‚

â€‹		POJ [3250 â€“ Bad Hair Day](http://poj.org/problem?id=3250)

3. å·¦å³é…å¯¹

   Leetcode [42 â€“ Trapping Rain Water](https://leetcode.cn/problems/trapping-rain-water/solutions/)

4. å¤šä¸ªåŒºé—´ä¸­çš„æœ€å€¼ / æŸä¸ªæ•°ä¸ºæœ€å€¼çš„æœ€é•¿åŒºé—´

   POJ [2796 â€“ Feel Good](http://poj.org/problem?id=2796)

5. å·§å¦™è¿ç”¨pop()åå®½åº¦çš„ç„å­¦é—®é¢˜ï¼š

   Leetcode [84 â€“ Largest Rectangle in Histogram]((https://leetcode.com/problems/largest-rectangle-in-histogram/))

   POJ [3494 â€“ Largest Submatrix of All 1â€™s](http://poj.org/problem?id=3494)



### å•è°ƒé˜Ÿåˆ—

#### æ¦‚å¿µï¼š

é¡¾åæ€ä¹‰ï¼Œå•è°ƒé˜Ÿåˆ—å°±æ˜¯åœ¨é˜Ÿåˆ—çš„åŸºç¡€ä¸Šï¼Œç»´æŠ¤ä¸€ä¸ªå•è°ƒçš„åºåˆ—ã€‚

#### æ€§è´¨ï¼š

1. é˜Ÿåˆ—ä¸­çš„å…ƒç´ å…¶å¯¹åº”åœ¨åŸæ¥çš„åºåˆ—ä¸­çš„é¡ºåºå¿…é¡»æ˜¯å•è°ƒé€’å¢çš„ã€‚
2. é˜Ÿåˆ—ä¸­å…ƒç´ çš„å¤§å°å¿…é¡»æ˜¯å•è°ƒé€’(å¢/å‡/è‡ªå®šä¹‰)ã€‚

#### å®ç°ï¼š

ã€æ¨¡æ¿ã€‘ã€æ»‘åŠ¨çª—å£ã€‘

```c++
#include <bits/stdc++.h>
using namespace std;
using ll = long long;
const int N = 2e5 + 9;
ll a[N];

int main()
{
    ios::sync_with_stdio(0), cin.tie(0), cout.tie(0);
    int n, k;cin >> n >> k;
    for(int i = 1;i <= n; ++ i) cin >> a[i];
    deque<int> dq;
    for(int i = 1;i <= n; ++ i)
    {
        //ç»´æŠ¤é˜Ÿåˆ—ä¸‹æ ‡åˆæ³•æ€§
        while(dq.size() && dq.front() < i - k + 1) dq.pop_front();
        //ç»´æŠ¤æœ€å¤§å€¼ï¼Œé˜Ÿåˆ—å³ä¾§ç»´æŠ¤åŒºé—´ä¸å¢æˆ–é€’å‡
        //æ³¨æ„ä¸€å®šè¦åˆ¤æ–­é˜Ÿåˆ—éç©ºï¼Œå¦åˆ™ä¼šRE
        while(dq.size() && a[dq.back()] <= a[i]) dq.pop_back();
        dq.push_back(i);
        if(i >= k) cout << a[dq.front()] << ' ';
    }
    cout << '\n';
    dq.clear();
    for(int i = 1;i <= n; ++ i)
    {
        //ç»´æŠ¤é˜Ÿåˆ—ä¸‹æ ‡åˆæ³•æ€§
        while(dq.size() && dq.front() < i - k + 1) dq.pop_front();
        //ç»´æŠ¤æœ€å¤§å€¼ï¼Œé˜Ÿåˆ—å³ä¾§ç»´æŠ¤åŒºé—´ä¸å‡æˆ–é€’å¢
        while(dq.size() && a[dq.back()] >= a[i]) dq.pop_back();
        dq.push_back(i);
        if(i >= k) cout << a[dq.front()] << ' ';
    }
    cout << '\n';
    return 0;
}
```

#### åº”ç”¨ï¼š

1. **æ»‘åŠ¨çª—å£æœ€å¤§å€¼/æœ€å°å€¼**ï¼š

   - ç»™å®šä¸€ä¸ªæ•°ç»„å’Œä¸€ä¸ªå›ºå®šå¤§å°çš„çª—å£ï¼Œè¦æ±‚åœ¨çª—å£æ»‘åŠ¨è¿‡ç¨‹ä¸­ï¼Œå®æ—¶è·å–çª—å£å†…çš„æœ€å¤§å€¼æˆ–æœ€å°å€¼ã€‚
   - ä¾‹å¦‚ï¼Œå¯¹äºæ•°ç»„ `[1, 3, -1, -3, 5, 3, 6, 7]` å’Œçª—å£å¤§å° `3`ï¼Œæ»‘åŠ¨çª—å£æœ€å¤§å€¼çš„ç»“æœæ˜¯ `[3, 3, 5, 5, 6, 7]`ã€‚

2. **ä¼˜åŒ–åŠ¨æ€è§„åˆ’é—®é¢˜**ï¼š

   - åœ¨ä¸€äº›åŠ¨æ€è§„åˆ’é—®é¢˜ä¸­ï¼Œå•è°ƒé˜Ÿåˆ—å¯ä»¥ç”¨æ¥ä¼˜åŒ–çŠ¶æ€è½¬ç§»è¿‡ç¨‹ï¼Œå‡å°‘æ—¶é—´å¤æ‚åº¦ã€‚
   - ä¾‹å¦‚ï¼Œåœ¨â€œæœ€å¤§å­æ•°ç»„å’Œâ€é—®é¢˜ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å•è°ƒé˜Ÿåˆ—æ¥ä¼˜åŒ–æ±‚è§£è¿‡ç¨‹ã€‚

3. **ä¼˜åŒ–åŒºé—´æŸ¥è¯¢é—®é¢˜**ï¼š

   - åœ¨ä¸€äº›åŒºé—´æŸ¥è¯¢é—®é¢˜ä¸­ï¼Œå•è°ƒé˜Ÿåˆ—å¯ä»¥ç”¨æ¥å¿«é€Ÿè·å–åŒºé—´å†…çš„æœ€å€¼ã€‚
   - ä¾‹å¦‚ï¼Œåœ¨â€œåŒºé—´æœ€å¤§å€¼æŸ¥è¯¢â€é—®é¢˜ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å•è°ƒé˜Ÿåˆ—æ¥ä¼˜åŒ–æŸ¥è¯¢è¿‡ç¨‹ã€‚

   

## åŒºé—´æ•°æ®ç»“æ„

å¯¹åŒºé—´çš„ä¸€äº›æ“ä½œï¼š

* æŸ¥è¯¢ï¼šå•ç‚¹å€¼ï¼ŒåŒºé—´å’Œï¼Œæœ€å€¼
* ä¿®æ”¹ï¼šå•ç‚¹æ›´æ–°ï¼ŒåŒºé—´æ›´æ–°

### æ ‘çŠ¶æ•°ç»„

#### æ¦‚å¿µï¼š

é¡¾åæ€ä¹‰ï¼Œåˆ©ç”¨æ•°ç»„æ¨¡æ‹Ÿæ ‘å½¢ç»“æ„ã€‚å¯ä»¥è§£å†³å¤§éƒ¨åˆ†åŸºäºåŒºé—´çš„æ›´æ–°ä»¥åŠæ±‚å’Œé—®é¢˜ã€‚

ä¸çº¿æ®µæ ‘çš„**åŒºåˆ«**ï¼šæ ‘çŠ¶æ•°ç»„å¯è§£å†³çš„é—®é¢˜çº¿æ®µæ ‘éƒ½å¯è§£å†³ï¼Œä½†æ ‘çŠ¶æ•°ç»„çš„ç³»æ•°è¦å°‘ï¼Œå®ç°ç›¸å¯¹å®¹æ˜“ã€‚å¯¹äºä¸€äº›é—®é¢˜ï¼Œæ²¡äººä¼šå°é¢˜å¤§åšã€‚

åšå®¢å¥½æ–‡ï¼š[æ ‘çŠ¶æ•°ç»„](https://www.cnblogs.com/xenny/p/9739600.html)ï¼Œ [äºŒç»´æ ‘çŠ¶æ•°ç»„](https://www.cnblogs.com/RabbitHu/p/BIT.html)

#### ä¼˜ç¼ºï¼š

ä¼˜ï¼šä¿®æ”¹å’ŒæŸ¥è¯¢çš„å¤æ‚åº¦éƒ½æ˜¯O(logN)ï¼Œè€Œä¸”ç›¸æ¯”çº¿æ®µæ ‘ç³»æ•°è¦å°‘å¾ˆå¤šï¼Œæ¯”ä¼ ç»Ÿæ•°ç»„è¦å¿«ï¼Œè€Œä¸”å®¹æ˜“å†™ã€‚

ç¼ºï¼šé‡åˆ°å¤æ‚çš„åŒºé—´é—®é¢˜è¿˜æ˜¯ä¸èƒ½è§£å†³ï¼›åŠŸèƒ½æœ‰é™ï¼Œå¦‚å¯¹æœ€å€¼çš„ç»´æŠ¤(è€ƒè™‘çº¿æ®µæ ‘ã€stè¡¨)ã€‚


#### åŸç†ï¼š

`lowbit(x)`ï¼šxçš„äºŒè¿›åˆ¶è¡¨è¾¾å¼ä¸­æœ€ä½ä½çš„1æ‰€å¯¹åº”çš„å€¼ï¼Œå¦‚ (6)10 = (110)2ï¼Œlowbit(6) = 2ã€‚

#### å®ç°ï¼š

1. å•ç‚¹æ›´æ–°ï¼Œå•ç‚¹æŸ¥è¯¢

	ä¼ ç»Ÿæ•°ç»„å¯åšã€‚

2. **å•ç‚¹æ›´æ–°ï¼ŒåŒºé—´æŸ¥è¯¢**
	
```c++
#include <bits/stdc++.h>
using namespace std;
using ll = long long;

const ll inf = 8e18,p = 998244353;
const ll N = 2e5 + 9;

int n,q;
ll t[N];

int lowbit(ll x) { return x & -x; }

void update(int k,ll v)
{
	for(int i = k;i <= n;i += lowbit(i)) t[i] += v;
	return;
}

ll getsum(int k)
{
	ll res = 0;
	for(int i = k;i > 0;i -= lowbit(i)) res += t[i];
	return res;
}

int main()
{
    ios::sync_with_stdio(0), cin.tie(0), cout.tie(0);
    int q;cin >> n >> q;
    for(int i = 1;i <= n; ++ i)
    {
        int x;cin >> x;
        update(i, x);
    }
    while(q --)
    {
        int op;cin >> op;
        if(op == 1)
        {
            ll k, x;cin >> k >> x;
            update(k, x);
        }
        else
        {
            ll l, r;cin >> l >> r;
            cout << getsum(r) - getsum(l - 1) << '\n';
        }
    }
    return 0;
}
```
3. **åŒºé—´æ›´æ–°ï¼ŒåŒºé—´æŸ¥è¯¢**
	
	æ ‘çŠ¶æ•°ç»„ç»´æŠ¤å·®åˆ†

```c++
#include <bits/stdc++.h>
using namespace std;
using ll = long long;

const ll N = 2e5+9;

ll arr[N],td[N],t_id[N];// tä¸ºæ ‘çŠ¶æ•°ç»„
ll n,q;

int lowbit(int x) { return x&(-x); }

void update(ll k, ll v)
{
    for(int i = k;i <= n;i += lowbit(i))
    {
       td[i] += v;
       t_id[i] += k*v;
    }
}

ll getSum(ll k)
{
    ll res = 0;
    for(int i = k;i > 0;i -= lowbit(i))
       res += (k+1)*td[i] - t_id[i];
    return res;
}

int main()
{
    ios::sync_with_stdio(0),cin.tie(0),cout.tie(0);
    cin >> n >> q;
    for(int i = 1;i <= n;i ++) cin >> arr[i];
    for(int i = 1;i <= n;i ++) update(i,arr[i]),update(i+1,-arr[i]);
    while(q --)
    {
        int tmp;cin >> tmp;
        if(tmp == 1)
        {
            ll l,r,v;cin >> l >> r >> v;
            update(l,v),update(r+1,-v);
        }
        else
        {
            int l,r;cin >> l >> r;
            cout << getSum(r) - getSum(l-1) << '\n';
        }
    }
    return 0;
} 
```

4. åŒºé—´æ›´æ–°ï¼Œå•ç‚¹æŸ¥è¯¢
	
	ç»´æŠ¤å·®åˆ†ï¼Œåªéœ€è¦ä¿®æ”¹æ›´æ–°æ–¹å¼å³å¯ã€‚   

### çº¿æ®µæ ‘

#### çº¿æ®µæ ‘ç®€ä»‹

çº¿æ®µæ ‘ï¼ˆSegment Treeï¼‰æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ•°æ®ç»“æ„ï¼Œåˆ©ç”¨åˆ†æ²»çš„æ€æƒ³ï¼Œå¯ä»¥ç”¨äºç»´æŠ¤ä¸€äº›æ»¡è¶³ç»“åˆå¾‹çš„åŒºé—´çš„ä¿¡æ¯ï¼Œä¾‹å¦‚åŒºé—´å…ƒç´ ä¹‹å’Œï¼ŒåŒºé—´å¼‚æˆ–å’Œã€‚

çº¿æ®µæ ‘å¯ä»¥å®ç°ğ‘‚(ğ‘™ğ‘œğ‘”ğ‘›)æ—¶é—´å¤æ‚åº¦çš„**åŒºé—´ä¿®æ”¹**å’Œ**åŒºé—´æŸ¥è¯¢**ï¼Œä¸æ ‘çŠ¶æ•°ç»„ç›¸æ¯”ï¼Œå®ƒæ›´å…·æœ‰é€šç”¨æ€§ï¼Œä½†æ˜¯å¸¸æ•°ç•¥å¤§ã€‚

##### çº¿æ®µæ ‘åŒºé—´åŠ æ³•

ç»™è¿™æ ·ä¸€ä¸ªæƒ…æ™¯ï¼šç»™å®šä¸€ä¸ªé•¿åº¦ä¸ºğ‘›($1 \le n \le 10^5$)çš„æ•°ç»„ğ‘($âˆ’10^9 \le ğ‘ \le 10^9$)ï¼Œå¯ä»¥è¿›è¡Œä¸¤ç§æ“ä½œï¼š

ï¼ˆ1ï¼‰å°†åŒºé—´$[l,r]$çš„å…ƒç´ éƒ½å¢åŠ xã€‚

ï¼ˆ2ï¼‰æŸ¥è¯¢åŒºé—´$[l,r]$çš„å…ƒç´ ä¹‹å’Œã€‚

æ“ä½œæ¬¡æ•°ä¸ºğ‘($1 \le ğ‘ \le 10^5$)ã€‚

æ ‘çŠ¶æ•°ç»„å¯ä»¥ç”¨æ¥æ¥ç»´æŠ¤åŒºé—´å’Œï¼Œå®ç°åŒºé—´ä¿®æ”¹å’ŒåŒºé—´æŸ¥è¯¢ï¼Œä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬å‡ ä¹ä¸ä¼šç”¨æ ‘çŠ¶æ•°ç»„æ¥ç»´æŠ¤åŒºé—´å’Œï¼Œå®ƒç»å¸¸ç”¨äºå•ç‚¹ä¿®æ”¹å’ŒåŒºé—´æŸ¥è¯¢ã€‚

åœ¨çº¿æ®µæ ‘ä¸­ï¼Œæˆ‘ä»¬çš„ä¸€ä¸ªç»“ç‚¹å°±è¡¨ç¤ºä¸€æ®µåŒºé—´ï¼ˆä¹Ÿå«ä¸€æ¡çº¿æ®µï¼Œæ•…åçº¿æ®µæ ‘ï¼‰ï¼Œå¹¶ä¸”çº¿æ®µæ ‘ä¸€å®šæ˜¯ä¸€æ£µäºŒå‰æ ‘ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸€èˆ¬ä¼šåˆ©ç”¨äºŒå‰æ ‘ç¼–å·çš„æ€§è´¨ï¼ˆç¼–å·ä¸ºğ‘¥çš„ç»“ç‚¹ï¼Œå·¦å„¿å­ä¸º2ğ‘¥ï¼Œå³å„¿å­ä¸º2ğ‘¥+1ï¼‰æ¥æ„é€ æ•´æ£µæ ‘ï¼Œè€Œä¸éœ€è¦è®°å½•å·¦å³å„¿å­å’Œçˆ¶äº²ï¼Œä½†æ˜¯åŒæ—¶ï¼Œè¿™ä¹Ÿä½¿å¾—æˆ‘ä»¬éœ€è¦å¼€å››å€äºğ‘›nçš„æ•°ç»„æ‰èƒ½å­˜ä¸‹æ•´æ£µæ ‘ï¼Œä¸€èˆ¬æˆ‘ä»¬ä»¥1å·ç»“ç‚¹ä½œä¸ºæ ¹ã€‚

å¦‚æœå½“å‰èŠ‚ç‚¹æ‰€è¡¨ç¤ºçš„åŒºé—´ä¸º$[s,e]$ï¼š

- å¦‚æœå½“å‰åŒºé—´å¤§å°>1ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…ˆè®¡ç®—ä¸€ä¸ªä¸­é—´å€¼ $\lfloor \frac{s+e}2 \rfloor$ï¼Œå°±èƒ½å¾—åˆ°å·¦å„¿å­è¡¨ç¤ºåŒºé—´$[s,mid]$ï¼Œå³å„¿å­è¡¨ç¤ºåŒºé—´ $[mid+1,e]$ã€‚
- å¦‚æœå½“å‰åŒºé—´å¤§å°=1ï¼Œé‚£ä¹ˆå½“å‰èŠ‚ç‚¹ä¸ºå¶å­ç»“ç‚¹ï¼Œæ²¡æœ‰å„¿å­ã€‚

###### ï¼ˆ1ï¼‰å‡†å¤‡å˜é‡

```cpp
using ll = long long;//ä½¿ç”¨long long
const int N = 2e5 + 9;
ll a[N];//åŸæ•°ç»„
int n;//åŸæ•°ç»„å¤§å°
ll t[N << 2];//å¼€4å€ç©ºé—´ï¼Œt[x]è¡¨ç¤ºç»“ç‚¹xæ‰€è¡¨ç¤ºçš„åŒºé—´çš„å…ƒç´ ä¹‹å’Œ
```

ï¼ˆæ‡’æ ‡è®°åœ¨åç»­è¡¥å……ï¼‰  

###### ï¼ˆ2ï¼‰ä¸Šæ‹‰æ“ä½œ

pushupï¼ˆä¸Šæ‹‰æ“ä½œï¼‰æ˜¯çº¿æ®µæ ‘æ‰€æœ‰æ“ä½œéƒ½éœ€è¦ç”¨åˆ°çš„å·¥å…·å‡½æ•°ï¼Œæˆ‘ä»¬å…ˆæŠŠå®ƒä»¬å®ç°ã€‚  
å†™æ³•éå¸¸ç®€å•ï¼Œpushupå°±æ˜¯ç”¨å„¿å­çš„ä¿¡æ¯æ¥æ›´æ–°è‡ªå·±çš„ä¿¡æ¯ã€‚

```cpp
//ç¬”è€…ä¹ æƒ¯ç”¨oè¡¨ç¤ºå½“å‰èŠ‚ç‚¹ç¼–å·
void pushup(int o)
{
    //o << 1 ç­‰ä»·äº o * 2ï¼ˆå·¦å„¿å­ç¼–å·ï¼‰
    //o << 1 | 1ç­‰ä»·äºo * 2 + 1ï¼ˆå³å„¿å­ç¼–å·ï¼‰
	t[o] = t[o << 1] + t[o << 1 | 1];
}
```

###### ï¼ˆ3ï¼‰å»ºæ ‘

å»ºæ ‘é‡‡ç”¨åˆ†æ²»çš„æ€æƒ³ï¼Œåˆ†åˆ«å°†å·¦å³å­æ ‘å»ºç«‹ï¼Œç„¶ååˆ©ç”¨pushupæ¥æ›´æ–°å½“å‰èŠ‚ç‚¹ï¼Œä»è€Œå»ºç«‹å½“å‰çš„å­æ ‘ã€‚

```cpp
//å»ºæ ‘ï¼Œé€’å½’
void buildTree(int s = 1, int e = n, int o = 1)
{
    if(s == e)
    {
        t[o] = a[s];
    	return;
    }
    int mid = (s + e) >> 1;
	buildTree(s, mid, o << 1), buildTree(mid + 1, e, o << 1 | 1);
	pushup(o);
}
```

###### ï¼ˆ4ï¼‰æ‡’æ ‡è®°

æ‡’æ ‡è®°ï¼ˆğ‘™ğ‘ğ‘§ğ‘¦ğ‘¡ğ‘ğ‘”ï¼‰ç”¨äºè¡¨ç¤ºæŸä¸ªèŠ‚ç‚¹å°šæœªæ›´æ–°ç»™å­èŠ‚ç‚¹çš„å€¼ï¼Œæ‡’æ ‡è®°æ˜¯ä¿è¯çº¿æ®µæ ‘çš„åŒºé—´ä¿®æ”¹å’ŒåŒºé—´æŸ¥è¯¢çš„å¤æ‚åº¦æ­£ç¡®æ€§çš„å…³é”®ã€‚  
åœ¨è¿™é‡Œç¬”è€…ä½¿ç”¨ğ‘™ğ‘§æ•°ç»„æ¥è¡¨ç¤ºğ‘™ğ‘ğ‘§ğ‘¦ğ‘¡ğ‘ğ‘”ã€‚

```cpp
ll lz[N << 2];
//lz[o]è¡¨ç¤ºï¼šç»“ç‚¹oè¿˜æœ‰lazy[o]è¿™ä¹ˆå¤§çš„ä¸€ä¸ªæ•°å­—ï¼Œè¿˜æ²¡åŠ ç»™å·¦å³å„¿å­
```

å½“ğ‘™ğ‘§[ğ‘œ]=0ï¼Œè¯´æ˜å½“å‰èŠ‚ç‚¹çš„å·¦å³å„¿å­éƒ½å·²ç»è¢«æ›´æ–°äº†ï¼Œå¾—åˆ°äº†æ­£ç¡®çš„å€¼ã€‚  
ä½¿ç”¨æ‡’æ ‡è®°åå¿…é¡»é…åˆä¸‹æ”¾æ“ä½œã€‚  

###### ï¼ˆ5ï¼‰ä¸‹æ”¾æ“ä½œ

pushdownï¼ˆä¸‹æ”¾æ“ä½œï¼‰éœ€è¦ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯è¡¨ç¤ºå½“å‰çš„æ“ä½œåŒºé—´ï¼ˆ$[ğ‘ ,ğ‘’]$ï¼‰å’Œç»“ç‚¹ç¼–å·ï¼ˆğ‘œï¼‰ã€‚

```cpp
void pushdown(int s, int e, int o)
{
	//å¦‚æœlz[o] == 0ï¼Œæ— éœ€ä¸‹æ”¾
    if(!lz[o])return;
    
    //lsè¡¨ç¤ºå·¦å„¿å­ç¼–å·ï¼Œrsè¡¨ç¤ºå³å„¿å­ç¼–å·
    int mid = (s + e) >> 1, ls = o << 1, rs = o << 1 | 1;
    
    //æ³¨æ„æ­¤å¤„çš„lazyä¼ é€’æ˜¯é‡ç‚¹ï¼
    //lz[o]è¡¨ç¤ºåŒºé—´æ¯ä¸ªç‚¹éƒ½è¦åŠ ä¸Šlz[o]
    //äºæ˜¯å¯¹äºtï¼ˆåŒºé—´å’Œï¼‰æ¥è¯´è¦ä¹˜ä¸Šä¸€ä¸ªåŒºé—´é•¿åº¦
    t[ls] += lz[o] * (mid - s + 1);
    t[rs] += lz[o] * (e - mid);
    
    //æ ‡è®°ä¹Ÿè¦ä¸‹æ”¾
    lz[ls] += lz[o], lz[rs] += lz[o];
    
    //lazytagä¸‹æ”¾å®Œæ¯•
    lz[o] = 0;
}
```

###### ï¼ˆ6ï¼‰åŒºé—´ä¿®æ”¹

å°†åŒºé—´$[l,r]$ä¸­çš„æ•°å­—éƒ½åŠ ä¸Šğ‘¥ï¼Œé‡‡ç”¨é€’å½’å½¢å¼ï¼Œå½“èµ°åˆ°äº†ç›®æ ‡åŒºé—´å†…ï¼Œå°±å°†å¯¹åº”çš„$t[o]$å’Œ$lz[o]$ä½œå‡ºä¿®æ”¹ã€‚  

```cpp
//l, r, xåœ¨é€’å½’è¿‡ç¨‹ä¸­æ˜¯ä¸å˜çš„
void add(int l, int r, ll x, int s = 1, int e = n, int o = 1)
{
	if(l <= s && e <= r)
    {
    	//å½“å‰æ“ä½œåŒºé—´å·²ç»å®Œå…¨è¿›å…¥ç›®æ ‡åŒºé—´
        //å½“å‰èŠ‚ç‚¹ä¿¡æ¯åº”å½“ç›´æ¥è¢«ä¿®æ”¹å¹¶æ‰“ä¸Šlzæ ‡è®°ï¼Œä¸å†å¾€ä¸‹èµ°
        t[o] += 1ll * (e - s + 1) * x;
        //åˆ°å½“å‰èŠ‚ç‚¹æ—¶ï¼Œt[o]ä¸ºæ­£ç¡®çš„å€¼ï¼Œlz[o]ä¸ä¸€å®šä¸º0
        //æ‰€ä»¥lz[o]ä¸èƒ½ç›´æ¥èµ‹å€¼ï¼Œè€Œåº”è¯¥åŠ ä¸Šx
        lz[o] += x;//æ‰“ä¸Šæ ‡è®°
        return;
    }
    
    //å‘ä¸‹èµ°ä¹‹å‰ï¼Œä¸€å®šè¦pushdown
    pushdown(s, e, o);
    
    //æ³¨æ„mid = (s + e) >> 1,è€Œä¸æ˜¯(l + r) >> 1
    int mid = (s + e) >> 1;
    
    //åˆ¤æ–­æ˜¯å¦éœ€è¦å‘å·¦èµ°ï¼Œå¦‚æœå·¦å„¿å­åŒºé—´[s, mid]å’Œ[l, r]æœ‰äº¤é›†ï¼Œå°±è¦èµ°
    //æ³¨æ„è¿™é‡Œæ— éœ€åˆ¤æ–­s <= rï¼Œå› ä¸ºè¿™æ˜¯å¿…ç„¶çš„
    //å¦‚æœs > rï¼Œé‚£ä¹ˆå½“å‰èŠ‚ç‚¹éƒ½è¿›ä¸æ¥
    if(mid >= l)add(l, r, x, s, mid, o << 1);//æ— éœ€è¿”å›å€¼
    //åˆ¤æ–­æ˜¯å¦éœ€è¦å‘å³èµ°ï¼Œå¦‚æœå³å„¿å­åŒºé—´[mid+1,e]å’Œ[l, r]æœ‰äº¤é›†ï¼Œå°±è¦èµ°
    if(mid + 1 <= r)add(l, r, x, mid + 1, e, o << 1 | 1);
	
    //é€’å½’å›æ¥çš„æ—¶å€™ï¼Œè®°å¾—pushup
    pushup(o);
}
```

###### ï¼ˆ7ï¼‰åŒºé—´æŸ¥è¯¢

åŒºé—´æŸ¥è¯¢ä¸åŒºé—´ä¿®æ”¹ç±»ä¼¼ï¼Œä»…åšä¸€äº›ç®€å•å˜åŒ–ã€‚

```cpp
ll query(int l, int r, int s = 1, int e = n, int o = 1)
{
	if(l <= s && e <= r)
    {
    	//å½“å‰æ“ä½œåŒºé—´å·²ç»å®Œå…¨è¿›å…¥ç›®æ ‡åŒºé—´
        //åˆ°å½“å‰èŠ‚ç‚¹æ—¶ï¼Œt[o]ä¸ºæ­£ç¡®çš„å€¼
        return t[o];
    }
    
    ll res = 0;//è®°å½•ç»“æœ
    
    //å‘ä¸‹èµ°ä¹‹å‰ï¼Œä¸€å®šè¦pushdown
    pushdown(s, e, o);
    
    //æ³¨æ„mid = (s + e) >> 1,è€Œä¸æ˜¯(l + r) >> 1
    int mid = (s + e) >> 1;
    //åˆ¤æ–­æ˜¯å¦éœ€è¦å‘å·¦èµ°ï¼Œå¦‚æœå·¦å„¿å­åŒºé—´[s, mid]å’Œ[l, r]æœ‰äº¤é›†ï¼Œå°±è¦èµ°
    if(mid >= l)res += query(l, r, s, mid, o << 1);//æ— éœ€è¿”å›å€¼
    //åˆ¤æ–­æ˜¯å¦éœ€è¦å‘å³èµ°ï¼Œå¦‚æœå³å„¿å­åŒºé—´[mid+1,e]å’Œ[l, r]æœ‰äº¤é›†ï¼Œå°±è¦èµ°
    if(mid + 1 <= r)res += query(l, r, mid + 1, e, o << 1 | 1);
	//queryæ²¡æœ‰è¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥å¯ä»¥ä¸pushupï¼Œå½“ç„¶å†™ä¸Šä¹Ÿä¸å½±å“

	return res;
}
```

è‡³æ­¤ï¼Œç»´æŠ¤åŒºé—´å’Œçš„çº¿æ®µæ ‘å®Œæˆã€‚

### stè¡¨



## å›¾è®º

### æœ€çŸ­è·¯
#### 1 æ˜¯ä»€ä¹ˆï¼Ÿ

**æœ€çŸ­è·¯é—®é¢˜ï¼ˆShortest Path Problem, `SPP`ï¼‰**æ˜¯å›¾è®ºä¸­çš„ä¸€ä¸ªç»å…¸é—®é¢˜ï¼Œæ—¨åœ¨æ‰¾åˆ°å›¾ä¸­ä¸¤ç‚¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ã€‚è¿™ä¸ªé—®é¢˜åœ¨è®¡ç®—æœºç§‘å­¦ã€è¿ç­¹å­¦ä»¥åŠç½‘ç»œè®¾è®¡ç­‰é¢†åŸŸæœ‰ç€å¹¿æ³›çš„åº”ç”¨ã€‚**
##### 1.1 å®šä¹‰

ç»™å®šä¸€ä¸ªå›¾ _G_ = (_V_,_E_)ï¼Œå…¶ä¸­ _V_ æ˜¯é¡¶ç‚¹é›†åˆï¼Œ_E_ æ˜¯è¾¹é›†åˆï¼Œæ¯æ¡è¾¹éƒ½æœ‰ä¸€ä¸ªç›¸åº”çš„æƒé‡ _w_ (e âˆˆ E)ã€‚æœ€çŸ­è·¯é—®é¢˜å°±æ˜¯è¦æ‰¾åˆ°å›¾ä¸­ä¸¤ä¸ªé¡¶ç‚¹ u å’Œ v ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ï¼Œå³æƒé‡ä¹‹å’Œæœ€å°çš„è·¯å¾„ã€‚

##### 1.2 åˆ†ç±»

æœ€çŸ­è·¯é—®é¢˜å¯ä»¥åˆ†ä¸º**ä¸¤**å¤§ç±»ï¼š

1. **æ— å‘å›¾çš„æœ€çŸ­è·¯é—®é¢˜**ï¼šåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå›¾ä¸­æ¯æ¡è¾¹éƒ½æ²¡æœ‰æ–¹å‘ï¼Œ_w_(_e_) é€šå¸¸è¡¨ç¤ºè¾¹ _e_ çš„é•¿åº¦æˆ–æˆæœ¬ã€‚
    
2. **æœ‰å‘å›¾çš„æœ€çŸ­è·¯é—®é¢˜**ï¼šåœ¨æœ‰å‘å›¾ä¸­ï¼Œè¾¹å…·æœ‰æ–¹å‘ï¼Œä»ä¸€ä¸ªé¡¶ç‚¹æŒ‡å‘å¦ä¸€ä¸ªé¡¶ç‚¹ï¼Œæ­¤æ—¶ _w_(_e_) å¯èƒ½è¡¨ç¤ºæ²¿è¾¹ _e_ è¡Œé©¶çš„è·ç¦»æˆ–æ—¶é—´ç­‰ã€‚
    

#### 2 æ€ä¹ˆåšï¼Ÿ

ç”±äºæ— å‘å›¾çš„æœ€çŸ­è·¯æ“ä½œå¯é€šè¿‡è½¬æ¢æœ‰å‘å›¾çš„æœ€çŸ­è·¯æ“ä½œå¾—åˆ°ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œåªè°ˆè®º**æœ‰å‘å›¾çš„æœ€çŸ­è·¯æ“ä½œ**ã€‚

##### 2.1 å•æº(Dijkstra)

###### 2.1.1 æ˜¯ä»€ä¹ˆï¼Ÿ

**å•æºæœ€çŸ­è·¯å¾„ï¼ˆSingle-Source Shortest Pathï¼‰**é—®é¢˜æ˜¯æŒ‡åœ¨ä¸€ä¸ªåŠ æƒå›¾ä¸­ï¼Œæ‰¾å‡ºä»**å•ä¸€æºç‚¹**ï¼ˆèµ·å§‹ç‚¹ï¼‰åˆ°å›¾ä¸­**æ‰€æœ‰å…¶ä»–é¡¶ç‚¹**ï¼ˆç›®æ ‡ç‚¹ï¼‰çš„**æœ€çŸ­è·¯å¾„**ã€‚è¿™é‡Œçš„â€œæœ€çŸ­â€é€šå¸¸æŒ‡çš„æ˜¯è·¯å¾„çš„**æ€»æƒé‡æœ€å°**ï¼Œå³ç»è¿‡çš„è¾¹æ•°æœ€å°‘æˆ–è€…æ‰€èŠ±è´¹çš„æ—¶é—´æœ€çŸ­ï¼Œå–å†³äºå›¾çš„åŠ æƒæ–¹å¼ã€‚

###### 2.1.2 Dijkstra

**å®šä¹‰ï¼š**

**Dijkstraç®—æ³•**æ˜¯ä¸€ç§å…·æœ‰**è´ªå¿ƒã€`dp`æ€æƒ³**çš„ç®—æ³•ï¼Œä¸»è¦ç”¨äºè§£å†³åŠ æƒå›¾ä¸­ä»**å•ä¸€æºé¡¶ç‚¹**åˆ°**æ‰€æœ‰å…¶ä»–é¡¶ç‚¹**çš„**æœ€çŸ­è·¯å¾„é—®é¢˜**ã€‚

å®ƒé€šè¿‡ä¸æ–­åœ°é€‰æ‹©æœªè®¿é—®é¡¶ç‚¹ä¸­è·ç¦»æœ€å°çš„é¡¶ç‚¹ï¼Œå¹¶æ›´æ–°å…¶æ‰€æœ‰é‚»æ¥ç‚¹çš„æœ€çŸ­è·¯å¾„é•¿åº¦ï¼Œç›´è‡³æ‰¾åˆ°æ‰€æœ‰é¡¶ç‚¹çš„æœ€çŸ­è·¯å¾„ã€‚

è¯¥ç®—æ³•ä¿è¯äº†å¾—åˆ°çš„æœ€ä¼˜è§£ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º`O(V^2)`ã€å…¶ä¸­Væ˜¯é¡¶ç‚¹çš„æ•°é‡ï¼›è¿™æ˜¯å› ä¸ºå¯¹äºæ¯ä¸ªé¡¶ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦éå†æ•´ä¸ªé¡¶ç‚¹é›†åˆæ¥æ‰¾åˆ°ä¸‹ä¸€ä¸ªæœ€çŸ­è·¯å¾„å€™é€‰é¡¶ç‚¹ã€‘ï¼›ä½†å¦‚æœä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—å¯ä»¥ä¼˜åŒ–åˆ°`O(E + V*logV)`ã€å…¶ä¸­Eæ˜¯è¾¹çš„æ•°é‡ï¼›è¿™æ˜¯å› ä¸ºå¯¹äºæ¯ä¸ªé¡¶ç‚¹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å¤„ç†æœ€å¤šEæ¡è¾¹ï¼Œæ¯å¤„ç†ä¸€æ¡è¾¹ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šåœ¨ä¼˜å…ˆé˜Ÿåˆ—ä¸­è¿›è¡Œ`VlogV`æ¬¡çš„æ“ä½œï¼ˆå› ä¸ºæ¯ä¸ªé¡¶ç‚¹æœ€å¤šè¢«å¼¹å‡º`VlogV`æ¬¡ï¼‰ã€‘ã€‚

**å®ç°ï¼š**

**æ­¥éª¤(æ–‡å­—æè¿°)ï¼š**

1. **åˆå§‹åŒ–**ï¼šé¦–å…ˆï¼Œç»™å›¾ä¸­çš„æ‰€æœ‰é¡¶ç‚¹èµ‹ä¸€ä¸ªåˆå§‹è·ç¦»å€¼ï¼Œé€šå¸¸å°†èµ·ç‚¹è®¾ç½®ä¸º0ï¼Œå…¶ä»–æ‰€æœ‰çš„é¡¶ç‚¹çš„è·ç¦»è®¾ç½®ä¸ºæ— ç©·å¤§infã€‚
    
2. **é€‰æ‹©æœ€è¿‘é¡¶ç‚¹**ï¼šåœ¨éå†æ•°ç»„ä¸­æ‰¾åˆ°è·ç¦»æœ€å°çš„é¡¶ç‚¹ã€‚
    
3. **æ›´æ–°é‚»æ¥é¡¶ç‚¹çš„è·ç¦»**ï¼šå°†å·²è®¿é—®é¡¶ç‚¹çš„æ‰€æœ‰é‚»æ¥é¡¶ç‚¹çš„è·ç¦» æ›´æ–°ä¸º MIN(å½“å‰å·²è®¿é—®é¡¶ç‚¹çš„è·ç¦» + å½“å‰é‚»æ¥é¡¶ç‚¹ä¸å·²è®¿é—®é¡¶ç‚¹ä¹‹é—´çš„è¾¹æƒå€¼ï¼Œè¯¥é‚»æ¥é¡¶ç‚¹çš„è·ç¦»)ã€‚
    
4. **é‡å¤æ­¥éª¤2å’Œ3**ï¼Œç›´è‡³æ‰€æœ‰é¡¶ç‚¹éƒ½è¢«è®¿é—®åˆ°ï¼Œæ­¤æ—¶ç®—æ³•ç»“æŸï¼Œå¾—åˆ°äº†ä»èµ·ç‚¹åˆ°æ‰€æœ‰é¡¶ç‚¹çš„æœ€çŸ­è·¯å¾„ã€‚

```c++
#include <bits/stdc++.h>
using namespace std;
using ll = long long;
const int N = 2e5 + 9;
// Dijkstra
// å•æºæœ€çŸ­è·¯.
// d[i]:è¡¨ç¤ºståˆ°içš„æœ€çŸ­è·ç¦»
// æ€æƒ³ï¼šgreedyï¼šæ¯æ¬¡æ‰¾æœ€è¿‘ç‚¹è¿›è¡Œæ‹“å±•
// Â  Â  Â  dpï¼šé€‰å–æœ€ä¼˜æ–¹æ¡ˆ
// ï¼Œæ¯ä¸ªç‚¹åªæ‹“å±•ä¸€æ¬¡ï¼Œä¸”æ‹“å±•æ—¶å·²ä¸ºæœ€çŸ­è·ç¦»
struct Edge
{
    int x,w;
};
vector<Edge> g[N];
â€‹
ll d[N];
int n,m;
â€‹
void dijkstra(int st)
{
    memset(d,0x3f,sizeof(ll) * (n + 1));
    d[st] = 0;
    bitset<N> vis; // è¡¨ç¤ºè¯¥ç‚¹å·²ç»æ‹“å±•è¿‡
    
    for(int i = 1;i <= n;++ i)
    {
        // æ‰¾å‡ºæœ€å°çš„ç‚¹(è·æºç‚¹æœ€å°çš„ç‚¹)
        int u = 1;
        for(int j = 1;j <= n;++ j)
        {
            if(vis[u] || (!vis[j] && d[j] < d[u])) u = j;
        }
        vis[u] = true; // è¡¨ç¤ºuå·²ç»æ‹“å±•è¿‡
        // æ­¤æ—¶d[u]å·²ä¸ºæœ€ä¼˜çš„
        for(auto &[v, w] : g[u])
        {
            if(!vis[v] && d[v] > d[u] + w) d[v] = d[u] + w;
        }
    }
}
â€‹
int main(void)
{
    ios::sync_with_stdio(0),cin.tie(0),cout.tie(0);
    cin >> n >> m;
    for(int i = 1;i <= m;i ++)
    {
        int u,v,w;cin >> u >> v >> w;
        if(u != v) g[u].push_back({v,w});
    }
    
    dijkstra(1);
    
    cout << (d[n] >= 0x3f3f3f3f ? -1 : d[n]) << '\n';
    return 0;
}
```

##### 2.2 å¤šæº(Floyd)

###### 2.2.1 æ˜¯ä»€ä¹ˆï¼Ÿ

**å¤šæºæœ€çŸ­è·¯å¾„é—®é¢˜ï¼ˆMulti-source shortest path problemï¼‰**æ˜¯å›¾è®ºä¸­çš„ä¸€ä¸ªç»å…¸é—®é¢˜ï¼Œå®ƒè¦æ±‚åœ¨ä¸€ä¸ªåŠ æƒå›¾ä¸­æ‰¾åˆ°ä»ä¸€ä¸ªç»™å®šçš„**å¤šä¸ªæºç‚¹**åˆ°**å…¶å®ƒæ‰€æœ‰é¡¶ç‚¹**çš„**æœ€çŸ­**è·¯å¾„ã€‚ä¸å•æºæœ€çŸ­è·¯å¾„é—®é¢˜ï¼ˆå¦‚Dijkstraç®—æ³•è§£å†³çš„é—®é¢˜ï¼‰ä¸åŒï¼Œå¤šæºæœ€çŸ­è·¯å¾„é—®é¢˜è€ƒè™‘çš„æ˜¯ä»**å¤šä¸ªèµ·ç‚¹**å‡ºå‘çš„æƒ…å†µã€‚

Floyd-Warshallç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(V^3)ï¼Œå…¶ä¸­Væ˜¯å›¾ä¸­é¡¶ç‚¹çš„æ•°é‡ã€‚è¿™æ˜¯å› ä¸ºç®—æ³•éœ€è¦å¯¹æ¯ä¸€å¯¹é¡¶ç‚¹è®¡ç®—æœ€çŸ­è·¯å¾„ï¼Œå¹¶ä¸”æ¯æ¬¡è®¡ç®—å¯èƒ½æ¶‰åŠåˆ°æ‰€æœ‰é¡¶ç‚¹ã€‚å› æ­¤ï¼Œå¯¹äºå¤§å‹å›¾ï¼ŒFloyd-Warshallç®—æ³•ä¼šéå¸¸æ…¢ã€‚

###### 2.2.2 Floyd

**å®šä¹‰ï¼š**

**Floyd-Warshallç®—æ³•**æ˜¯ä¸€ä¸ªè®¡ç®—å›¾ä¸­**æ‰€æœ‰é¡¶ç‚¹å¯¹**ä¹‹é—´æœ€çŸ­è·¯å¾„çš„ç®—æ³•ã€‚å®ƒé€‚ç”¨äºåŠ æƒå›¾ä¸­ï¼ŒåŒ…æ‹¬æœ‰å‘å›¾å’Œæ— å‘å›¾ï¼Œå¹¶ä¸”å¯ä»¥å¤„ç†å›¾ä¸­åŒ…å«è´Ÿæƒè¾¹çš„ç‰¹æ®Šæƒ…å†µï¼ˆç„¶è€Œï¼Œå¦‚æœå›¾ä¸­å­˜åœ¨è´Ÿæƒå›è·¯ï¼Œå³æ€»æƒé‡ä¸ºè´Ÿçš„ç¯ï¼ŒFloyd-Warshallç®—æ³•å¯èƒ½ä¼šæŠ¥å‘Šä¸å­˜åœ¨æœ€çŸ­è·¯å¾„ï¼Œå› ä¸ºåœ¨è´Ÿæƒå›è·¯ä¸­ï¼Œè·¯å¾„å¯ä»¥æ— é™åœ°å˜çŸ­ï¼‰

**å®ç°ï¼š**

Floyd-Warshallç®—æ³•çš„**åŸºæœ¬æ€æƒ³**æ˜¯é€æ­¥æ¨ç®—å‡ºæ›´é•¿è·ç¦»çš„æœ€çŸ­è·¯å¾„ã€‚å®ƒè€ƒè™‘äº†æ‰€æœ‰é¡¶ç‚¹å¯¹ä¹‹é—´çš„è·¯å¾„ï¼Œå¹¶æ›´æ–°è¿™äº›è·¯å¾„çš„æœ€çŸ­è·ç¦»ï¼Œä¹Ÿå°±æ˜¯**dp**ã€‚

**æ­¥éª¤(æ–‡å­—æè¿°)ï¼š**

1. **åˆå§‹åŒ–**ï¼šåˆ›å»ºä¸€ä¸ªäºŒç»´æ•°ç»„dï¼Œå…¶ä¸­d [ i ]  [ j ]è¡¨ç¤ºä»é¡¶ç‚¹iåˆ°é¡¶ç‚¹jçš„è·ç¦»ï¼Œå¦‚æœiå’Œjä¹‹é—´æ²¡æœ‰ç›´æ¥è¿æ¥çš„è¾¹ï¼Œåˆ™d [ i ]  [ j ]è®¾ç½®ä¸ºæ— ç©·å¤§ã€‚
    
2. **é€æ­¥æ¨ç®—**ï¼šå¯¹äºå›¾ä¸­çš„æ¯ä¸€ä¸ªé¡¶ç‚¹kï¼Œé€šè¿‡è€ƒè™‘é¡¶ç‚¹iåˆ°é¡¶ç‚¹kå†åˆ°é¡¶ç‚¹jçš„è·¯å¾„ï¼Œæ¯”è¾ƒå¹¶æ›´æ–°d [ i ]  [ j ] çš„å€¼ï¼Œå¦‚æœd [ i ]  [ k ]  + d [ k ]  [ j ]  < d [ i ]  [ j ] ï¼Œåˆ™å°†d [ i ]  [ j ] æ›´æ–°ä¸º d [ i ]  [ k ]  + d [ k ]  [ j ] ã€‚
    
3. **é‡å¤æ­¥éª¤2**ï¼Œç›´åˆ°æ‰€æœ‰çš„é¡¶ç‚¹å¯¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„éƒ½è¢«è®¡ç®—å‡ºæ¥ã€‚
```c++
#include <bits/stdc++.h>
using namespace std;
using ll = long long;
const int N = 333;
// Floyd
// å¤šæºæœ€çŸ­è·¯
// æ€æƒ³ï¼šdp
ll d[N][N]; // d[i][j]è¡¨ç¤ºiåˆ°jçš„æœ€çŸ­è·¯
int n,m,q;

int main(void)
{
    ios::sync_with_stdio(0),cin.tie(0),cout.tie(0);
    cin >> n >> m >> q;
    memset(d,0x3f,sizeof(d));
 Â  Â // å»ºå›¾
    for(int i = 1;i <= m;i ++)
    {
        ll u,v,w;cin >> u >> v >> w;
        d[u][v] = min(d[u][v],w);
    }
    
    // åˆå§‹åŒ–ï¼Œè€ƒè™‘åˆ°è‡ªç¯ï¼Œé‡è¾¹
    for(int i = 1;i <= n;i ++) d[i][i] = 0; 
    // æ³¨æ„å¾ªç¯ä¸€å®šæ˜¯ä¸¥æ ¼æŒ‰ç…§ â€œä¸­è½¬ç‚¹-èµ·ç‚¹-ç»ˆç‚¹â€ è¿›è¡Œloop
    for(int k = 1;k <= n;k ++) // ä¸­è½¬ç‚¹
    {
        for(int i = 1;i <= n;i ++) // èµ·ç‚¹
        {
            for(int j = 1;j <= n;j ++) // ç»ˆç‚¹
            {
                d[i][j] = min(d[i][j],d[i][k] + d[k][j]);
            }
        }
    }
    while(q --)
    {
        int u,v;cin >> u >> v;
        cout << (d[u][v] >= 0x3f3f3f3f ? -1 : d[u][v]) << '\n';
    }
    return 0;
}
```
å¯¹äºFloydçš„çŠ¶æ€è½¬ç§»ä¸ºä½•ä¸¥æ ¼æŒ‰ç…§â€œä¸­è½¬ç‚¹-èµ·ç‚¹-ç»ˆç‚¹â€ è¿›è¡Œloopï¼Œæœ¬è’Ÿè’»è¿™é‡Œä¸è¿›è¡Œä¸¥æ ¼è¯æ˜æ¨å¯¼(æœ¬è’Ÿè’»å¤ªèœäº†)ï¼Œè¯´ä¸æ˜ç™½ã€‚è¯·æ‚¨ç§»æ­¥ã€‚

**Floyd-Warshallç®—æ³•**å¯ä»¥**ä¸€æ¬¡**è®¡ç®—å‡ºå›¾ä¸­**æ‰€æœ‰é¡¶ç‚¹å¯¹**ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ï¼›å¹¶ä¸”ååˆ†**çµæ´»**ï¼Œå¯ä»¥å¤„ç†**å¸¦æœ‰è´Ÿæƒè¾¹**çš„å›¾ï¼Œå³ä½¿æ˜¯é‚£äº›æƒé‡å¤§äºé›¶çš„è¾¹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¯¥ç®—æ³•ï¼›è€Œä¸”å¦‚æœå›¾ä¸­å­˜åœ¨**è´Ÿæƒå›è·¯**ï¼Œå³æ€»æƒé‡ä¸ºè´Ÿçš„ç¯ï¼ŒFloyd-Warshallç®—æ³•èƒ½å¤Ÿ**æ£€æµ‹**åˆ°è¿™ä¸€ç‚¹ï¼Œå¹¶æŠ¥å‘Š**ä¸å­˜åœ¨**æœ€çŸ­è·¯å¾„ã€‚

ä½†æ˜¯ï¼Œ**Floyd-Warshallç®—æ³•**çš„çš„æ—¶**é—´å¤æ‚åº¦ä¸ºO(V^3)**ï¼Œå¯¹äº**å¤§å‹å›¾**ï¼Œè¿™ä¸ªç®—æ³•å¯èƒ½ä¼šéå¸¸**æ…¢**ï¼›è€Œç”±äºç®—æ³•éœ€è¦è®¡ç®—æ‰€æœ‰é¡¶ç‚¹å¯¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ï¼Œæ‰€ä»¥å½“**å›¾ç¨€ç–**æ—¶ï¼Œå³é¡¶ç‚¹ä¹‹é—´çš„è¾¹å¾ˆå°‘æ—¶ï¼Œç®—æ³•çš„**æ•ˆç‡ä¼šå¾ˆä½**ã€‚

### æœ€å°ç”Ÿæˆæ ‘

#### 1 æ˜¯ä»€ä¹ˆï¼Ÿ

è¦è®¤è¯†**æœ€å°ç”Ÿæˆæ ‘**ï¼Œæˆ‘ä»¬æˆ–è®¸è¦å…ˆäº†è§£**ç”Ÿæˆæ ‘**çš„**æ¦‚å¿µ**ã€‚

**ç”Ÿæˆæ ‘ï¼ˆSpanning Treeï¼‰**ï¼šæŒ‡åœ¨ä¸€ä¸ª**æ— å‘å›¾**ä¸­ï¼ŒåŒ…å«å›¾ä¸­**Vä¸ªé¡¶ç‚¹å’ŒV-1æ¡è¾¹çš„**çš„å­è¿é€šå›¾ï¼ˆä¸å¦¨è®¾**V**ä¸ºå›¾çš„**èŠ‚ç‚¹ä¸ªæ•°**ï¼‰ã€‚

è€Œ**æœ€å°ç”Ÿæˆæ ‘ï¼ˆMinimum Spanning Treeï¼Œç®€ç§°MSTï¼‰**å°±æ˜¯ç”Ÿæˆæ ‘ä¸­**æƒå€¼å’Œæœ€å°**çš„æ ‘ã€‚

#### 2 æ€ä¹ˆæ±‚ï¼Ÿ

æ±‚è§£**æœ€å°ç”Ÿæˆæ ‘**çš„å¸¸è§ç®—æ³•**åŒ…æ‹¬**æ™®é‡Œå§†ç®—æ³•ï¼ˆPrimâ€™s Algorithmï¼‰ã€å…‹é²æ–¯å¡å°”ç®—æ³•ï¼ˆKruskalâ€™s Algorithmï¼‰å’Œç´¢å°”è¿ç§‘ç®—æ³•ï¼ˆBorÅ¯vkaâ€™s Algorithmï¼‰ã€‚è¿™äº›ç®—æ³•åœ¨ä¸åŒçš„æƒ…å†µä¸‹æœ‰ä¸åŒçš„æ•ˆç‡å’Œé€‚ç”¨æ€§ï¼Œç®€è¦æ¦‚æ‹¬å¦‚ä¸‹ï¼š

1. **æ™®é‡Œå§†ç®—æ³• (Primâ€™s Algorithm)**ï¼š
   - é€‚ç”¨äºè¾¹**æƒé‡å·®å¼‚è¾ƒå¤§**çš„å›¾ã€‚
   - å¼€å§‹äºå›¾ä¸­çš„ä¸€ä¸ªé¡¶**ç‚¹**ï¼Œé€æ­¥å¢åŠ æ–°çš„è¾¹å’Œé¡¶ç‚¹ï¼Œç›´åˆ°å½¢æˆæœ€å°ç”Ÿæˆæ ‘ã€‚
   - æ¯æ¬¡éƒ½é€‰æ‹©è¿æ¥å·²é€‰é¡¶ç‚¹é›†ä¸æœªé€‰é¡¶ç‚¹é›†ä¸­æƒé‡æœ€å°çš„è¾¹ã€‚
   - ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º *O*(*E*+*V*log*V*)ï¼ˆå…¶ä¸­ *E* æ˜¯è¾¹æ•°ï¼Œ*V* æ˜¯é¡¶ç‚¹æ•°ï¼‰ã€‚
2. **å…‹é²æ–¯å¡å°”ç®—æ³• (Kruskalâ€™s Algorithm)**ï¼š
   - é€‚ç”¨äºè¾¹**æƒé‡å·®å¼‚è¾ƒå°**çš„å›¾ã€‚
   - å…ˆå°†æ‰€æœ‰**è¾¹**æŒ‰æƒé‡æ’åºï¼Œç„¶åæŒ‰é¡ºåºé€‰æ‹©è¾¹ï¼Œåªè¦è¿™æ¡è¾¹ä¸ä¼šä¸å·²ç»é€‰æ‹©çš„è¾¹å½¢æˆç¯ï¼Œå°±åŠ å…¥åˆ°ç”Ÿæˆæ ‘ä¸­ã€‚
   - é€‚ç”¨äºåŒ…å«å¤šä¸ªè¿é€šåˆ†é‡çš„å›¾ã€‚
   - ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿä¸º *O*(*E*+*V*log*V*)ã€‚
3. **ç´¢å°”è¿ç§‘ç®—æ³• (BorÅ¯vkaâ€™s Algorithm)**ï¼š
   - é€‚ç”¨äº**ä»»ä½•ç±»å‹**çš„å›¾ã€‚
   - åˆå§‹åŒ–æ—¶æ¯ä¸ªé¡¶ç‚¹éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ ‘ã€‚
   - ç„¶åæ¯æ¬¡æ‰¾åˆ°æ¯ä¸ªè¿é€šåˆ†é‡ä¸­æƒé‡æœ€å°çš„è¾¹ï¼Œå¹¶å°†å…¶åŠ åˆ°æ£®æ—ä¸­ï¼Œç›´åˆ°æ£®æ—å˜æˆä¸€æ£µæ ‘ã€‚
   - ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º *O*(*E*log*V*)ã€‚

åœ¨è¿™é‡Œåªè°ˆè®ºæ›´å¸¸ç”¨çš„**Primå’ŒKruskalç®—æ³•**ã€‚

##### 2.1 Prim

**Prim**æ˜¯åŸºäº**ç‚¹**çš„ç®—æ³•ï¼Œ**æœ´ç´ **çš„åšæ³•æ—¶é—´å¤æ‚åº¦ä¸ºO(n^2)ï¼ˆnæ˜¯é¡¶ç‚¹æ•°ï¼‰**å †ä¼˜åŒ–**åä¸ºO(nlogn)ï¼›ç”±äºä¸å›¾ä¸­è¾¹æ•°æ— å…³ï¼Œæ‰€ä»¥ç›¸è¾ƒä¹‹ä¸‹ï¼Œæ›´é€‚ç”¨äº**ç¨ å¯†å›¾**ã€‚

**åŸºæœ¬æ€æƒ³**ï¼š

1. **åˆå§‹åŒ–**ï¼šé€‰æ‹©å›¾ä¸­çš„ä»»ä¸€é¡¶ç‚¹(é€šå¸¸ä¸º1)ï¼Œå¹¶å°†å…¶åŠ å…¥æœ€å°ç”Ÿæˆæ ‘ä¸­ã€‚
2. **é€‰æ‹©æœ€å°æƒé‡çš„è¾¹çš„ç‚¹**ï¼šåœ¨å‰©ä½™çš„é¡¶ç‚¹ä¸­ï¼Œæ‰¾åˆ°ä¸å·²é€‰é¡¶ç‚¹é›†åˆè¿æ¥çš„è¾¹æ˜¯æœ€å°æƒé‡çš„ç‚¹ã€‚
3. **æ·»åŠ é¡¶ç‚¹ï¼Œæ›´æ–°è·ç¦»(æƒé‡)**ï¼šå°†è¿™ä¸ªé¡¶ç‚¹åŠ å…¥åˆ°æœ€å°ç”Ÿæˆæ ‘ä¸­ï¼Œå¹¶æ›´æ–°è·ç¦»ã€‚
4. **é‡å¤æ­¥éª¤2å’Œ3**ï¼šé‡å¤é€‰æ‹©æœ€å°æƒé‡çš„è¾¹ä¸é¡¶ç‚¹çš„æ­¥éª¤ï¼Œç›´åˆ°æ‰€æœ‰mçš„é¡¶ç‚¹éƒ½è¢«åŠ å…¥æœ€å°ç”Ÿæˆæ ‘ä¸­ã€‚
5. **ç»“æŸ**ï¼šå½“æ‰€æœ‰çš„é¡¶ç‚¹éƒ½è¢«åŠ å…¥æœ€å°ç”Ÿæˆæ ‘ï¼Œç®—æ³•ç»“æŸï¼Œæ­¤æ—¶å½¢æˆçš„æ ‘å°±æ˜¯æœ€å°ç”Ÿæˆæ ‘ã€‚

**ä¼ªä»£ç **ï¼š

```c++
// é€‰ä»»ä¸€ç‚¹ä¸ºèµ·ç‚¹(ä¸å¦¨ä¸º1)
// for(n-1æ¬¡){
    // æ¯æ¬¡ç¡®å®šä¸€æ¡è¾¹
    // åœ¨æ‰€æœ‰ç‚¹ä¸­æ‰¾ç¦»intreeä¸­çš„ç‚¹æœ€è¿‘çš„ç‚¹ 
    // åŠ å…¥intreeï¼Œæ›´æ–°æ‰€æœ‰ç‚¹åˆ°intreeä¸­ä»»æ„ç‚¹çš„æœ€è¿‘è·ç¦»d[]
// }
```

**Primæ ¸å¿ƒ**ï¼šç»´æŠ¤ä¸€ä¸ªintreeé›†åˆï¼Œæ¯æ¬¡ä»å¤–é¢æ‰¾ä¸€ä¸ªæœ€è¿‘çš„ï¼ˆç›¸é‚»çš„ï¼‰åŠ å…¥ï¼ŒåŠ å…¥åæ›´æ–°é‚»æ¥ç‚¹ã€‚

###### 2.1.1 æœ´ç´ å®ç° åˆ©ç”¨Array ã€æ—¶é—´å¤æ‚åº¦O(n^2)ã€‘

ä»£ç å¦‚ä¸‹ï¼š

```c++
#include <bits/stdc++.h>
using namespace std;
using ll = long long;
const int N = 1e3 + 9;
const ll inf = 4e18,p = 998244353;
ll a[N][N],d[N]; // ç”¨é‚»æ¥çŸ©é˜µæ¥å­˜ æ•°æ®èŒƒå›´ä¸èƒ½å¯è¿‡å¤§
bitset<N> intree;
void solve()
{
    // input
	int n,m;cin >> n >> m;
    // åˆå§‹åŒ–inf
	memset(a,0x3f3f3f3f,sizeof(a));
	memset(d,0x3f3f3f3f,sizeof(d));
	for(int i = 1;i <= m;i ++)
	{
		ll u,v,w;cin >> u >> v >> w;
        // æ— å‘å›¾
		a[u][v] = min(a[u][v],w);
		a[v][u] = min(a[v][u],w);
	}
	ll ans = 0;
    // å°†1é¡¶ç‚¹åŠ å…¥intreeï¼Œå¹¶æ›´æ–°çŠ¶æ€å’Œè·ç¦»
	intree[1] = true;
	d[1] = 0;
	for(int j = 1;j <= n;j ++)
	{
        // jç‚¹åœ¨æ ‘å†…ï¼Œè·³è¿‡
		if(intree[j]) continue;
		// æ›´æ–°è·ç¦»
		d[j] = min(d[j],a[1][j]);
	} 
	
	for(int i = 1;i < n;i ++)
	{
		int u = 1; // uæ˜¯æˆ‘ä»¬è¦æ‰¾çš„è·ç¦»intreeä¸­çš„ç‚¹æœ€è¿‘çš„ç‚¹
		for(int j = 1;j <= n;j ++)
		{
            // è‹¥uåœ¨æ ‘å†…ï¼Œåˆ™ç›´æ¥æ¢ï¼›ä¸åœ¨ï¼Œåˆ¤æ–­jæ˜¯å¦ä¸åœ¨æ ‘å†…ä¸”d[j]<d[u]
			if(intree[u] || (!intree[j] && d[j] < d[u])) u = j;
		}
		ans += d[u];
        // å·²åœ¨æ ‘å†…ï¼Œæ›´æ”¹çŠ¶æ€
		intree[u] = true;
		d[u] = 0;
		// æ›´æ–°æ‰€æœ‰ç‚¹åˆ°intreeä¸­ä»»æ„ç‚¹çš„æœ€çŸ­è·ç¦»
		for(int j = 1;j <= n;j ++)
		{
			if(intree[j]) continue;
			
			d[j] = min(d[j],a[u][j]);
		} 
	}
    // output
	cout << ans << '\n';
}
int main(void)
{
	ios::sync_with_stdio(0),cin.tie(0),cout.tie(0);
	int _;cin >> _;
	while(_ --)
	{
		solve();
	}
	return 0;
}
```

æˆ–

```c++
#include <bits/stdc++.h>
using namespace std;
using ll = long long;
const int N = 1e3 + 9;
const ll inf = 4e18,p = 998244353;
ll a[N][N],d[N]; // é‚»æ¥çŸ©é˜µ æ•°æ®èŒƒå›´ä¸èƒ½è¿‡å¤§
bitset<N> intree;
void solve()
{
    // input
	int n,m;cin >> n >> m;
    // åˆå§‹åŒ–
	memset(a,0x3f3f3f3f,sizeof(a));
	memset(d,0x3f3f3f3f,sizeof(d));
    // å»ºå›¾
	for(int i = 1;i <= m;i ++)
	{
		ll u,v,w;cin >> u >> v >> w;
		a[u][v] = min(a[u][v],w);
		a[v][u] = min(a[v][u],w);
	}
	ll ans = 0;
	
	for(int i = 1;i <= n;i ++)
	{
		int u = 1; // uæ˜¯æˆ‘ä»¬è¦æ‰¾çš„è·ç¦»intreeä¸­çš„ç‚¹æœ€è¿‘çš„ç‚¹
		for(int j = 1;j <= n;j ++)
		{
			if(intree[u] || (!intree[j] && d[j] < d[u])) u = j;
		}
        // ç¬¬ä¸€æ¬¡intreeä¸­å¹¶æ— å…ƒç´ ï¼Œå…¶d[u]æ˜¯infï¼Œä¸èƒ½åŠ å…¥ans
		if(d[u] < inf) ans += d[u];
		intree[u] = true;
		d[u] = 0;
		// æ›´æ–°è·ç¦»
		for(int j = 1;j <= n;j ++)
		{
			if(intree[j]) continue;
			
			d[j] = min(d[j],a[u][j]);
		} 
	}
	cout << ans << '\n';
}
int main(void)
{
	ios::sync_with_stdio(0),cin.tie(0),cout.tie(0);
	int _;cin >> _;
	while(_ --)
	{
		solve();
	}
	return 0;
}
```

###### 2.1.2 å †ä¼˜åŒ– åˆ©ç”¨priority_queue ã€æ—¶é—´å¤æ‚åº¦O(VlogV)ã€‘(V=>é¡¶ç‚¹æ•°)

```c++
#include <bits/stdc++.h>
using namespace std;
using ll = long long;
const int N = 1e5 + 9;
const ll inf = 4e18,p = 998244353;
// è·ç¦»(æƒé‡)
ll d[N];
// æœ€å°ç”Ÿæˆæ ‘
bitset<N> intree;
// è¾¹
struct Edge
{
	ll x,w; // å‡ºç‚¹ï¼Œæƒå€¼
	bool operator < (const Edge& u) const
	{
		return w == u.w ? x < u.x : w > u.w;
	}
};
// å›¾
vector<Edge> g[N];

void solve()
{
    // input
	int n,m;cin >> n >> m;
	// åˆå§‹åŒ–
	memset(d,0x3f3f3f3f,sizeof(d));
	// å»ºå›¾
	for(int i = 1;i <= m;i ++)
	{
		ll u,v,w;cin >> u >> v >> w;
		g[u].push_back({v,w});
		g[v].push_back({u,w});
	}
	ll ans = 0;
	
	priority_queue<Edge> pq;
	// åˆå§‹åŒ–ï¼ŒåŠ å…¥ä¸€ä¸ªç‚¹
	d[1] = 0;
	pq.push({1,0});
	
	while(pq.size())
	{
        // è·ç¦»intreeä¸­æœ€è¿‘çš„ç‚¹
		auto [x,w] = pq.top();pq.pop();
		if(intree[x]) continue; // è‹¥åœ¨æ ‘å†…ï¼Œè·³è¿‡
		intree[x] = true; // æ›´æ”¹çŠ¶æ€
		
		ans += w;
		d[x] = 0;
		// æšä¸¾æ‰€æœ‰å‡ºè¾¹
		for(auto &[y, w] :g[x])
		{
            // ä¸åœ¨æ ‘å†…å¹¶ä¸”æƒå€¼æ›´å°æ‰push
			if(!intree[y] && w < d[y])
			{
				 d[y] = w; // æ›´æ–°è·ç¦»
				 pq.push({y,w});
			}
		}
	}
    // æ£€æŸ¥æ˜¯å¦æœ‰ç‚¹ä¸åœ¨æ ‘å†…ï¼Œè‹¥æœ‰ï¼Œåˆ™æœªç”Ÿæˆ
	for(int i = 1;i <= n;i ++) 
	{
		if(!intree[i])
		{
			ans = -1;
			break;
		}
	}
	cout << ans << '\n';
}
int main(void)
{
	ios::sync_with_stdio(0),cin.tie(0),cout.tie(0);
	int _ = 1; // cin >> _;
	while(_ --)
	{
		solve();
	}
	return 0;
}
```

 #### 2.2 Kruskal è´ªå¿ƒ ã€æ—¶é—´å¤æ‚åº¦ O(mlogm)ã€‘

**Kruskal**æ˜¯åŸºäº**è¾¹**çš„ç®—æ³•ï¼Œä¸»è¦æ€æƒ³æ˜¯**è´ªå¿ƒ**ï¼Œæ‰€ä»¥ç”¨åˆ°äº†**æ’åº**ï¼Œ**æ—¶é—´å¤æ‚åº¦**å‡ ä¹æ˜¯O(mlogm)(m æ˜¯è¾¹æ•°)ï¼ˆå› ä¸ºå¹¶æŸ¥é›†çš„æ“ä½œå¯è¿‘ä¼¼çœ‹ä½œO(1)ï¼‰ï¼Œæ‰€ä»¥æ›´é€‚ç”¨äºç¨€ç–å›¾(Sparse graph)ã€‚

**åŸºæœ¬æ€æƒ³**ï¼š

è´ªå¿ƒ

1ï¼‰ç»™è¾¹ä»å°åˆ°å¤§æ’åº

2ï¼‰ä»å°åˆ°å¤§é€‰è¾¹

{uï¼Œvï¼Œw}

è‹¥u,vå·²è”é€šï¼šè·³è¿‡ã€åˆ¤æ–­è”é€šç”¨å¹¶æŸ¥é›†ã€‘

è‹¥u,væœªè”é€šï¼šé€‰ä¸Šï¼Œå¹¶è¿æ¥

ä¸€ä¸ªæ¨¡æ¿é¢˜ï¼š

[**P72 ã€æ¨¡æ¿ã€‘æœ€å°ç”Ÿæˆæ ‘**](https://www.starrycoding.com/problem/72)
**ä»£ç å¦‚ä¸‹**ï¼š

```c++
#include <bits/stdc++.h>
using namespace std;
using ll = long long;
const int N = 1e5 + 9;
const ll inf = 4e18,p = 998244353;

// è·ç¦»(æƒé‡)
ll d[N];

struct Edge// è¾¹
{
	ll u,v,w;// å…¥ç‚¹ï¼Œå‡ºç‚¹ï¼Œæƒå€¼
	bool operator < (const Edge& m) const // é‡è½½è¿ç®—ç¬¦ï¼Œæ’åº
	{
		return w == m.w ? (u == m.u ? v < m.v : u < m.u) : w < m.w;
	}
};

// å¹¶æŸ¥é›†
int pre[N];
int root(int x){return pre[x] = (pre[x] == x ? x : root(pre[x]));}

void solve()
{
    // input
	int n,m;cin >> n >> m;
	// åˆå§‹åŒ–
	memset(d,0x3f3f3f3f,sizeof(d));
	vector<Edge> es;
	// å»ºå›¾
	for(int i = 1;i <= m;i ++)
	{
		ll u,v,w;cin >> u >> v >> w;
		es.push_back({u,v,w});
	}
    // æ’åº
	sort(es.begin(),es.end());
	ll ans = 0;
    // å¹¶æŸ¥é›†åˆå§‹åŒ–
	for(int i = 1;i <= n;i ++) pre[i] = i;
	for(auto &[u,v,w] : es)
	{
        // å¦‚æœè”é€šï¼Œè·³è¿‡
		if(root(u) == root(v)) continue;
		
		ans += w;
        // æ›´æ–°çŠ¶æ€
		pre[root(u)] = root(v);
	}
	// åˆ¤æ–­æ˜¯å¦å½¢æˆäº†ç”Ÿæˆæ ‘
	for(int i = 1;i < n;i ++) if(root(i) != root(i + 1)) {cout << -1;return;}
	// output
	cout << ans << '\n';
}
int main(void)
{
	ios::sync_with_stdio(0),cin.tie(0),cout.tie(0);
	int _ = 1; // cin >> _;
	while(_ --)
	{
		solve();
	}
	return 0;
}
```

è™½è¯´ï¼Œè¿™ä¸¤ä¸ªéƒ½å¯ä»¥æ±‚å¾—æœ€å°ç”Ÿæˆæ ‘ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸éš¾å‘ç°ï¼ŒPrimç®—æ³•ä¸­åªè®°å½•äº†ç‚¹è¢«é€‰æ‹©ï¼Œå¹¶ä¸çŸ¥é“ç‚¹ä¸ç‚¹ä¹‹é—´å¦‚ä½•è¿æ¥ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥ç¼–å†™è®°å½•å®ƒä»¬å¦‚ä½•è¿æ¥çš„ä»£ç ï¼›ä½†Kruskalç®—æ³•ç®—å‡ºæƒå€¼çš„åŒæ—¶ï¼Œä¹Ÿæ˜¯è®°å½•ä¸‹äº†è¾¹ï¼ŒåŒ…æ‹¬å…¶å…¥ç‚¹å’Œå‡ºç‚¹ï¼Œä½ å¯ä»¥ç”»å‡ºæœ€å°ç”Ÿæˆæ ‘ã€‚æ¬¡å¤–ï¼ŒKruskalåœ¨ä»£ç å®ç°ä¸Šä¹Ÿæ›´ç®€å•ï¼Œåœ¨å¤§å¤šæƒ…å†µä¸‹ï¼ŒKruskalæˆ–è®¸ä¼šæ›´å¥½ç”¨ã€‚

### æ ‘ä¸Šé—®é¢˜

#### æœ€è¿‘å…¬å…±ç¥–å…ˆ(LCA)

[[æ¨¡æ¿é¢˜](https://www.luogu.com.cn/problem/P3379)]

##### å®šä¹‰ï¼š

æœ€è¿‘å…¬å…±ç¥–å…ˆç®€ç§° LCAï¼ˆLowest Common Ancestorï¼‰ã€‚ä¸¤ä¸ªèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆï¼Œå°±æ˜¯è¿™ä¸¤ä¸ªç‚¹çš„å…¬å…±ç¥–å…ˆé‡Œé¢ï¼Œç¦»æ ¹æœ€è¿œçš„é‚£ä¸ªã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯ä¸¤ä¸ªç‚¹åœ¨è¿™æ£µæ ‘ä¸Šè·ç¦»æœ€è¿‘çš„å…¬å…±ç¥–å…ˆèŠ‚ç‚¹ã€‚

æ‰€ä»¥LCAä¸»è¦æ˜¯ç”¨æ¥å¤„ç†å½“ä¸¤ä¸ªç‚¹ä»…æœ‰å”¯ä¸€ä¸€æ¡ç¡®å®šçš„æœ€çŸ­è·¯å¾„æ—¶çš„è·¯å¾„ã€‚

##### æ€§è´¨ï¼š

1. `LCA({u}) = u`;
2. `u`æ˜¯`v`çš„ç¥–å…ˆï¼Œå½“ä¸”ä»…å½“`LCA(u,v) = u`;
3. å¦‚æœ`u`ä¸ä¸º`v`çš„ç¥–å…ˆå¹¶ä¸”`v`ä¸ä¸º`u`çš„ç¥–å…ˆï¼Œé‚£ä¹ˆ`u,v`åˆ†åˆ«å¤„äº`LCA(u,v)`çš„ä¸¤æ£µä¸åŒå­æ ‘ä¸­ï¼›
4. å‰åºéå†ä¸­ï¼Œ`LCA(S)`å‡ºç°åœ¨æ‰€æœ‰`S`ä¸­å…ƒç´ ä¹‹å‰ï¼Œååºéå†ä¸­`LCA(S)`åˆ™å‡ºç°åœ¨æ‰€æœ‰`S`ä¸­å…ƒç´ ä¹‹åï¼›
5. ä¸¤ç‚¹é›†å¹¶çš„æœ€è¿‘å…¬å…±ç¥–å…ˆä¸ºä¸¤ç‚¹é›†åˆ†åˆ«çš„æœ€è¿‘å…¬å…±ç¥–å…ˆçš„æœ€è¿‘å…¬å…±ç¥–å…ˆï¼Œå³`LCA(AâˆªB) = LCA(LCA(A), LCA(B))`ï¼›
6. ä¸¤ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆå¿…å®šå¤„åœ¨æ ‘ä¸Šä¸¤ç‚¹é—´çš„æœ€çŸ­è·¯ä¸Šï¼›
7. `d(u,v) = h(u) + h(v) - 2h(LCA(u,v))`ï¼Œå…¶ä¸­`d`æ˜¯æ ‘ä¸Šä¸¤ç‚¹é—´çš„è·ç¦»ï¼Œ`h`ä»£è¡¨æŸç‚¹åˆ°æ ‘æ ¹çš„è·ç¦»ã€‚
##### æ±‚æ³•ï¼š

###### 1. å€å¢æ³• O(*nlogn*)

å€å¢æ³•ä¸»è¦æ˜¯å¯¹æœ´ç´ ç®—æ³•çš„æ”¹è¿›ã€‚é€šè¿‡é¢„å¤„ç†`p`æ•°ç»„ï¼Œæ¸¸æ ‡å¯ä»¥å¿«é€Ÿçš„ç§»åŠ¨ï¼Œå¤§å¹…å‡å°‘æ¸¸æ ‡è·³è½¬æ¬¡æ•°ï¼Œ`p[u][i]` è¡¨ç¤ºèŠ‚ç‚¹`u`çš„ç¬¬ 2^i ä¸ªç¥–å…ˆï¼Œä¹Ÿå°±æ˜¯ä»èŠ‚ç‚¹`u`å‘ä¸Šè·³äº† 2^i æ¬¡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡`dfs`é¢„å¤„ç†`p`æ•°ç»„ã€‚

æ“ä½œï¼š
1. å°†`u,v`ç§»åŠ¨åˆ°åŒä¸€æ·±åº¦ã€‚`i`ä»å¤§åˆ°å°è¿›è¡Œè·³è½¬ï¼Œæˆ‘ä»¬è®¡ç®—å‡º`u,v`çš„æ·±åº¦å·®ï¼Œè®°ä¸ºyã€‚å°†`y`è¿›è¡ŒäºŒè¿›åˆ¶æ‹†åˆ†ï¼Œå¯ä»¥å°†æ¸¸æ ‡è·³è½¬ä¼˜åŒ–è‡³`[yçš„äºŒè¿›åˆ¶è¡¨ç¤ºæ‰€å«1çš„ä¸ªæ•°]`æ¬¡ã€‚æ•´ä¸ªè¿‡ç¨‹å°±ç±»ä¼¼äºäºŒè¿›åˆ¶æ•°ä½1çš„å¡«å……ï¼Œæ¯”å¦‚ï¼šæ•°å­—5(0101)ï¼Œä»é«˜ä½åˆ°ä½ä½ï¼š5 < 8 ==> 0 , 5 >= 4 ==> 1 , 1 < 2 ==> 0 , 1  >= 1 ==> 1ã€‚
2. `u,v`è·³è½¬åˆ°ç›¸åŒæ·±åº¦æ—¶ï¼šé¦–å…ˆåˆ¤æ–­`u,v`æ˜¯å¦ç›¸ç­‰ï¼Œè‹¥ç›¸ç­‰ï¼Œè¿”å›`u`å³`LCA`ï¼›å¦åˆ™è¿›è¡Œä¸‹é¢è·³è½¬æ“ä½œï¼Œæˆ‘ä»¬`i`ä»å¤§åˆ°å°å¼€å§‹å°è¯•ï¼Œä¸€ç›´åˆ°0ï¼Œå¦‚æœ`p[u][i] != p[v][i],åˆ™u = p[u][i],v = p[v][i]`ï¼›å› ä¸ºæˆ‘ä»¬åœ¨è·³æ—¶ï¼Œä¸å¯ç›´æ¥è·³åˆ°`u,v`çš„`LCA`ï¼Œå› ä¸ºè¿™ä¼šè¯¯åˆ¤ï¼Œåœ¨çœŸæ­£çš„LCAä¹‹ä¸Šçš„æ•°éƒ½ä¼šæ˜¯ç›¸åŒçš„ï¼Œä½†å®ƒä»¬åªæ˜¯`u,v`çš„ç¥–å…ˆã€‚æ‰€ä»¥æˆ‘ä»¬è¦è·³åˆ°LCAçš„ä¸‹é¢ä¸€å±‚ï¼Œè¿”å›`p[u][0]`å³LCAã€‚

é¢„å¤„ç†æ—¶é—´å¤æ‚åº¦ï¼šO(`nlogn`)ï¼Œå•æ¬¡æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ï¼šO(`logn`)ã€‚
```c++
#include <bits/stdc++.h>
using namespace std;
using ll = long long;
const int N = 5e5 + 9;	// æ•°æ®èŒƒå›´
int n,m,s;				// èŠ‚ç‚¹æ•° è¯¢é—®æ•° æ ¹èŠ‚ç‚¹
int d[N],p[N][21];		// æ·±åº¦ å€å¢å‘ä¸Šè·³çš„æ•°ç»„
vector<int> e[N];		// é‚»æ¥è¡¨
void dfs(int u,int f)	// é¢„å¤„ç† dæ·±åº¦ å’Œ pæ•°ç»„
{
	d[u] = d[f] + 1;	// æ·±åº¦æ˜¯çˆ¶äº²çš„æ·±åº¦+1
	p[u][0] = f;		// å‘ä¸Šè·³2^0å³1æ˜¯çˆ¶äº²èŠ‚ç‚¹
	for(int i = 1;i <= 20;i ++)		// è®¾ç½®å…¶ä»–å‘ä¸Šè·³2^içš„èŠ‚ç‚¹
		p[u][i] = p[p[u][i - 1]][i - 1];	// å…³é”®ï¼šå‘ä¸Šè·³2^{i}å°±æ˜¯åœ¨å‘ä¸Šè·³2^{i-1}å†å‘ä¸Šè·³2^{i-1}
	for(auto &i : e[u])	// ç»§ç»­å‘ä¸‹èµ°
	{
		if(i == f) continue;
		dfs(i,u);
	}
}
int lca(int u,int v)	// æ±‚æœ€è¿‘å…¬å…±ç¥–å…ˆ
{
	if(d[u] < d[v]) swap(u,v);	// ä¸å¦¨è¦æ±‚uçš„æ·±åº¦å¤§äºv
	for(int i = 20;i >= 0;i --)	// ä½¿äºŒè€…ä½äºç›¸åŒæ·±åº¦
		if(d[p[u][i]] >= d[v]) u = p[u][i];
	
	if(u == v) return u;		// è‹¥v==uï¼Œé‚£ä¹ˆuå°±æ˜¯æœ€è¿‘å…¬å…±ç¥–å…ˆï¼Œè¿”å›
	for(int i = 20;i >= 0;i --)	// 
	{
		if(p[u][i] != p[v][i])	// æœ€ç»ˆäºŒè€…è·³åˆ°æœ€è¿‘å…¬å…±ç¥–å…ˆçš„ä¸‹ä¸€å±‚
		{
			u = p[u][i];
			v = p[v][i];
		}
	}
	return p[u][0];				// è¿”å›uçš„çˆ¶äº²å³LCA
}

void solve()
{
	cin >> n >> m >> s;
	int u,v;
    // å»ºæ ‘
	for(int i = 1;i < n;i ++)
	{
		cin >> u >> v;
		e[u].push_back(v);
		e[v].push_back(u);
	}
	dfs(s,0);
    // è¯¢é—®
	while(m --)
	{
		cin >> u >> v;
		int w = lca(u,v);
		cout << w << '\n';
	}
}
int main()
{
	ios::sync_with_stdio(0),cin.tie(0),cout.tie(0);
	int t = 1; // cin >> t;
	while(t --) solve();
	return 0;
}
```

###### 2. Tarjanç¦»çº¿ç®—æ³•


```c++

```
###### 3. é‡é“¾å‰–åˆ†


```c++
#include <bits/stdc++.h>
using namespace std;
using ll = long long;
const int N = 5000005;
const int INF = 0x3f3f3f3f;
const int mod = 1e9 + 7;

vector<int> G[N];	// é‚»æ¥è¡¨å­˜æ ‘
int fa[N];			// çˆ¶èŠ‚ç‚¹
int dep[N];			// æ·±åº¦
int top[N];			// é“¾å¤´
int sz[N];			// æ ‘å¤§å°
int son[N];			// é‡å„¿å­

void dfs1(int u)
{
	sz[u] = 1;
	dep[u] = dep[fa[u]] + 1;
	for(auto &v : G[u])
	{
		if(v == fa[u]) continue;
		fa[v] = u;
		dfs1(v);
		sz[u] += sz[v];
		if(sz[v] > sz[son[u]]) son[u] = v;
	}
}

void dfs2(int u,int h)
{
	top[u] = h;
	if(son[u]) dfs2(son[u],h);
	for(auto &v :G[u])
	{
		if(v == fa[u] || v == son[u]) continue;
		dfs2(v,v);
	}
}

int LCA(int x,int y)
{
	while(top[x] != top[y])
	{
		if(dep[top[x]] > dep[top[y]])
			x = fa[top[x]];
		else
			y = fa[top[y]];
	}
	return dep[x] < dep[y] ? x : y;
}

int main()
{
	ios::sync_with_stdio(0),cin.tie(0),cout.tie(0);
	int n,m,s;cin >> n >> m >> s;
	for(int i = 1;i < n;i ++)
	{
		int u,v;cin >> u >> v;
		G[u].push_back(v);
		G[v].push_back(u);
	}
	dfs1(s),dfs2(s,s);
	while(m --)
	{
		int x,y;cin >> x >> y;
		cout << LCA(x,y) << '\n';
	}
	return 0;
}
```
###### 4. dfsåºè½¬åŒ–ä¸º RMQ é—®é¢˜


```c++
// DFSåºè½¬æ¢ä¸º RMQ æ±‚LCAï¼Œnlogné¢„å¤„ç†ï¼ŒO(1)æŸ¥è¯¢
// åœ¨ x != y æ—¶ï¼Œä»¤ dfn[x] < dfn[y]ï¼ŒæŸ¥è¯¢ [dfn[x] + 1, dfn[y]] ä¸­æ·±åº¦æœ€å°çš„çˆ¶èŠ‚ç‚¹å°±æ˜¯lca
#include <bits/stdc++.h>
using namespace std;
using ll = long long;

const int N = 500005;
const int INF = 0x3f3f3f3f;
const int mod = 1e9 + 7;

vector<int> G[N];	// é‚»æ¥è¡¨å­˜æ ‘
// st[i][0] ç›´æ¥å­˜dfsåºçš„çˆ¶äº²ç¼–å·
int d[N],dfn[N],ck;
int st[N][20];

void dfs(int u,int fa)
{
	st[++ ck][0] = fa;
	dfn[u] = ck;
	d[u] = d[fa] + 1;
	for(auto &v :G[u])
	{
		if(v == fa) continue;
		dfs(v,u);
	}
}

int RMQ(int l,int r)
{
	if(l > r) swap(l,r);
	int k = __lg(r - l + 1);
	int x = st[l][k],y = st[r - (1 << k) + 1][k];
	return d[x] <= d[y] ? x : y;
}

int LCA(int x,int y)
{
	if(x == y) return x;
	if(dfn[x] > dfn[y]) swap(x,y);
	return RMQ(dfn[x] + 1,dfn[y]);
}

int main()
{
	ios::sync_with_stdio(0),cin.tie(0),cout.tie(0);
	int n,m,s;cin >> n >> m >> s;
	for(int i = 1;i < n;i ++)
	{
		int u,v;cin >> u >> v;
		G[u].push_back(v);
		G[v].push_back(u);
	}
	dfs(s,0);
	for(int j = 1;1 << j <= ck;j ++)
		for(int i = 1;i + (1 << j) - 1 <= ck;i ++)
		{
			int x = st[i][j - 1],y = st[i + (1 << j - 1)][j - 1];
			st[i][j] = d[x] <= d[y] ? x : y;
		}
	
	while(m --)
	{
		int x,y;cin >> x >> y;
		cout << LCA(x,y) << '\n';
	}
	return 0;
}
```
## æ•°è®º
### ç»„åˆæ•°
## DP
### èƒŒåŒ…DP

#### 0-1 èƒŒåŒ…

##### å¼•å…¥

é¢˜æ„æ¦‚è¦ï¼šæœ‰ *N* ä¸ªç‰©å“å’Œä¸€ä¸ªå®¹é‡ä¸º *W* çš„èƒŒåŒ…ï¼Œæ¯ä¸ªç‰©å“æœ‰é‡é‡ *w[i]* å’Œä»·å€¼ *v[i]* ä¸¤ç§å±æ€§ï¼Œè¦æ±‚é€‰è‹¥å¹²ç‰©å“æ”¾å…¥èƒŒåŒ…ä½¿èƒŒåŒ…ä¸­ç‰©å“çš„æ€»ä»·å€¼æœ€å¤§ä¸”èƒŒåŒ…ä¸­ç‰©å“çš„æ€»é‡é‡ä¸è¶…è¿‡èƒŒåŒ…çš„å®¹é‡ã€‚

åœ¨ä¸Šè¿°ä¾‹é¢˜ä¸­ï¼Œç”±äºæ¯ä¸ªç‰©ä½“åªæœ‰ä¸¤ç§å¯èƒ½çš„çŠ¶æ€ï¼ˆå–ä¸ä¸å–ï¼‰ï¼Œå¯¹åº”äºŒè¿›åˆ¶ä¸­çš„ 0 å’Œ 1 ï¼Œè¿™ç±»é—®é¢˜ä¾¿è¢«ç§°ä¸ºã€Œ0-1 èƒŒåŒ…é—®é¢˜ã€ã€‚


#### å®Œå…¨èƒŒåŒ…

